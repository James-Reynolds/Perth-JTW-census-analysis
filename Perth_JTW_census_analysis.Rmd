---
title: "Perth COVID-19 study; journey to work census analysis"
runningheader: "Perth COVID-19 study; journey to work census analysis" # only for pdf output
subtitle: "Perth COVID-19 study; journey to work census analysis" # only for html output
author: "Dr James Reynolds, Monash University Public Transport Research Group (PTRG)"
date: "`r Sys.Date()`"
output:
  tufte::tufte_html: default
  tufte::tufte_handout:
    citation_package: natbib
    latex_engine: xelatex
  tufte::tufte_book:
    citation_package: natbib
    latex_engine: xelatex
bibliography: Perth_JTW_census_analysis.bib
link-citations: yes
---

```{r setup, include=FALSE}
library(tufte)
library(tidyverse)
library(sp)
library(ggplot2)
library(sf)
library(ASGS.foyer)
library(raster)
library(ggmap)
library(units)
library(absmapsdata)
library(readabs)
library(readr)
library(janitor)
library(scales)
library(ggstatsplot)
library(ggmap)
library(knitr)
library(abs)
library(readr)
library(prmisc)

# invalidate cache when the tufte version changes
knitr::opts_chunk$set(cache.extra = packageVersion('tufte'))
options(htmltools.dir.version = FALSE)
```

# 1.0 Introduction
Monash University's Public Transport Research Group (PTRG) is looking at changes in travel behaviour in Perth surrounding the COVID-19 pandemic. Part of this work involves examining the Australian Bureau of Statistics (ABS) journey-to-work data for the 2016 and 2021 censuses. Areas of interest are: 

- an aggregate analysis for all of the Greater Perth area;

- a disaggregate analysis for three groupings of Perth Local Government Areas (LGAs) defined in previous PTRG work as: the North-south grouping^[City of Melville, City of South Perth, City of Stirling, City of Joondalup, City of Wanneroo, City of Cockburn, City of Kwinana, City of Rockingham, City of Murray and City of Mandurah.], the Heritage grouping ^[City of Bayswater, City of Belmont, City of Canning, City of Fremantle, City of Nedlands, City of Perth, City of Subiaco, City of Vincent, Shire of Peppermint Grove, Town of Bassendean, Town of Cambridge, Town of Claremont, Town of Cottesloe, Town of East Fremantle, Town of Mosman Park, Town of Victoria Park and City of Gosnells.] and the Outer-east grouping^[City of Kalamunda, City of Swan, Shire of Mundaring, City of Armadale, and Shire of Serpentine-Jarrahdale.].

-	Perth CBD^[Here the central City of Perth is adopted.]  / non-CBD-based Jobs, for all of Greater Perth and for the North-south, Heritage and Outer-east groupings
  
This working note details the process of collecting and reviewing the ABS data. It is structured as follows: the next section details the processing of the ABS data; Section 3 presents the results; followed by a brief discussion in Section 4; and conclusions in Section 5. 

# 2.0 Methods and data
The census provides data at a range of geographical scales and levels of detail. Ideally for this analysis the data would be downloaded at the lowest scale of interest, and then aggregated to larger areas^[For example, get the census data at LGA level for place of usual residence and place of work, then aggregate up to the three groupings and Greater Perth.]. However, a problem is that random alternations are made by the census to cells with small values so that individuals cannot be identified^[As this analysis is looking at 15 different JTW modes there will be a lot of small cells.].  Hence, aggregation will only combine these errors. Therefore it is necessary to download the data multiple times, at the highest geographical level needed for each part of the analsis.  


## 2.1 JTW for Greater Perth (usual residence)
Data tables for the 2016 and 2021 census were obtained for the journey to work mode for all of Greater Perth^[See Greater_Perth_UR_JTW_2016.csv and Greater_Perth_UR_JTW_2021.csv].


```{r load_abs_2021_2016_Greater_Perth_UR, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=TRUE, fig.cap="Perth 2021 destination zonea", cache=TRUE}
Greater_Perth_UR_JTW_2016 <- read_csv("~/0001 projects/Perth-JTW-census-analysis/01 data/Greater_Perth_UR_JTW_2016.csv", skip = 8)
Greater_Perth_UR_JTW_2021 <- read_csv("~/0001 projects/Perth-JTW-census-analysis/01 data/Greater_Perth_UR_JTW_2021.csv", skip = 8)

#drop unneeded rows and columns
Greater_Perth_UR_JTW_2016 <- tibble(Greater_Perth_UR_JTW_2016[2,1:17])
Greater_Perth_UR_JTW_2021 <- tibble(Greater_Perth_UR_JTW_2021[2,1:17])

#Clean names
Greater_Perth_UR_JTW_2016 <- clean_names(Greater_Perth_UR_JTW_2016)
Greater_Perth_UR_JTW_2021 <- clean_names(Greater_Perth_UR_JTW_2021)

#set names as consistent WATCH OUT, the order of walked_only and other_mode is flipped in the 2016 and 2021 data 
names(Greater_Perth_UR_JTW_2021) <- c("mtw15p_method_of_travel_to_work_15_travel_modes", "train", "bus", "ferry", "tram", "taxi", "car_as_driver", "car_as_passenger", "truck", "motorbike_scooter", "bicycle","other_mode", "walked_only", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")  

#set train column as numeric
Greater_Perth_UR_JTW_2016$train <- as.numeric(Greater_Perth_UR_JTW_2016$train)
Greater_Perth_UR_JTW_2021$train <- as.numeric(Greater_Perth_UR_JTW_2021$train)
```


## 2.2 JTW for by LGA (usual residence)
Data tables for the 2016 and 2021 census were obtained for the journey to work mode by LGA of Usual Residence (UR)^[For LGAs within Western Australia only.] and LGA of Place Of Work (POW)^[For all LGAs in Australia.]. The CSV files provide the LGA POW and mode volumes for each LGA UR in turn^[See Greater_Perth_JTW_by_DZ_and_LGA_2016.csv and Greater_Perth_JTW_by_DZ_and_LGA_2021.csv.]. To get these into a usable format^[i.e. a separate CSV file for each LGA UR.] the Table_Builder_Reader tool^[See https://github.com/vlc/table_builder_io/] was used. 



```{r load_abs_2021_2016_LGA_UR, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=TRUE, fig.cap="Perth 2021 destination zonea", cache=TRUE}


####Next add the JTW data by DZ and LGA
## by Year and DZ and LGA data from ABS comes in a single file, with multiple CSV sections for each LGA. I found https://pypi.org/project/table_builder_io/ which deals with this issue over in python. 
##adapted from https://github.com/vlc/table_builder_io/ code in python
#from table_builder_io import TableBuilderReader
# Load python and pandas
#reader = TableBuilderReader.from_file("/Users/julianreynolds/Documents/work/Monash University/Greater_Perth_JTW_by_DZ_and_LGA_2021.csv")
#df = reader.read_table(as_index=True)
#df2 = reader.read(as_index=False)

##then from https://stackoverflow.com/a/55168518
#for i in df2: 
#   df2[i].to_csv('dataframe_id_'+str(i)+'.csv')
##All of this results in an output of everything in a separated CSV for each LGA. 
##Some stuffing around required as python does not play well with '0's and / etc in file names


#Load JTW by LGA (usual residence) and LGA (place of work)
list_csv_files <- list.files(path = "01 data/2016", full.names = TRUE)
LGA_UR_JTW_2016 <- readr::read_csv(list_csv_files, id = "file_name")
list_csv_files <- list.files(path = "01 data/2021", full.names = TRUE)
LGA_UR_JTW_2021 <- readr::read_csv(list_csv_files, id = "file_name")

#Extract LGA name from filename field
LGA_UR_JTW_2016$lga_name_2016 <- sub(".*dataframe_id_","", LGA_UR_JTW_2016$file_name)
LGA_UR_JTW_2016$lga_name_2016 <- sub(".csv.*","", LGA_UR_JTW_2016$lga_name_2016)
LGA_UR_JTW_2021$lga_name_2021 <- sub(".*dataframe_id_","", LGA_UR_JTW_2021$file_name)
LGA_UR_JTW_2021$lga_name_2021 <- sub(".csv.*","", LGA_UR_JTW_2021$lga_name_2021)

#clean names
LGA_UR_JTW_2016 <- clean_names(LGA_UR_JTW_2016)
LGA_UR_JTW_2021 <- clean_names(LGA_UR_JTW_2021)

#Select only total rows
LGA_UR_JTW_2016 <- LGA_UR_JTW_2016 %>% filter(lga_pow  == "Total")
LGA_UR_JTW_2021 <- LGA_UR_JTW_2021 %>% filter(lga_pow  == "Total")

#remove unneeded column and set so that column names are consistent
##assume that 2021 LGAs are the same as 2016 LGAs
LGA_UR_JTW_2016 <- tibble (lga_name_2021 = LGA_UR_JTW_2016$lga_name_2016, LGA_UR_JTW_2016[,3:19])
LGA_UR_JTW_2021 <- tibble (lga_name_2021 = LGA_UR_JTW_2021$lga_name_2021, LGA_UR_JTW_2021[,3:19])

#Set 2021 column names to match 2016 column names
names(LGA_UR_JTW_2021) <- c("lga_name_2021", "lga_pow", "train", "bus", "ferry", "tram", "taxi", "car_as_driver", "car_as_passenger", "truck", "motorbike_scooter", "bicycle", "other_mode",    "walked_only", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")    

```

The "Total" row was extracted from each CSV file, to provide total mode volumes for each LGA of UR. The Heritage, North-south and Outer east groupings were added to the datasets. 
```{r LGA_UR_add_groupings, echo=FALSE, fig.margin=TRUE, fig.cap="Perth 2021 destination zonea", cache=TRUE}
LGA_to_group <- tibble(lga_name_2021 = 
c("Melville", "South Perth", "Stirling", "Joondalup", "Wanneroo", "Cockburn", "Kwinana", "Rockingham", "Murray", "Mandurah",
  "Bayswater", "Belmont", "Canning","Fremantle", "Nedlands", "Perth", "Subiaco", "Vincent", "Peppermint Grove", "Bassendean", "Cambridge", "Claremont", "Cottesloe", "East Fremantle", "Mosman Park", "Victoria Park","Gosnells",
  "Kalamunda", "Swan", "Mundaring", "Armadale", "Serpentine-Jarrahdale", "Northam", "York"),
grouping = c("North-south", "North-south","North-south","North-south","North-south","North-south","North-south","North-south","North-south","North-south", "Heritage", "Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage", "Outer-east", "Outer-east","Outer-east","Outer-east","Outer-east", "Outer-east","Outer-east")
)

#join grouping to JTW data frames
LGA_UR_JTW_2016 <- left_join(LGA_UR_JTW_2016, LGA_to_group, by = "lga_name_2021")
LGA_UR_JTW_2021 <- left_join(LGA_UR_JTW_2021, LGA_to_group, by = "lga_name_2021")


#Define place of work destination groupings
LGA_UR_JTW_2016$place_of_work <- with(LGA_UR_JTW_2016, ifelse(LGA_UR_JTW_2016$lga_pow == "Perth", 
                                                                              "CBD", 
                                                                              ifelse(LGA_UR_JTW_2016$lga_pow %in% LGA_to_group$lga_name_2021, 
                                                                                     "Rest of Greater Perth", 
                                                                                     "Other")
                                                                              )
                                              )

 #Define place of work destination groupings
LGA_UR_JTW_2021$place_of_work <- with(LGA_UR_JTW_2021, ifelse(LGA_UR_JTW_2021$lga_pow == "Perth", 
                                                                              "CBD", 
                                                                              ifelse(LGA_UR_JTW_2021$lga_pow %in% LGA_to_group$lga_name_2021, 
                                                                                     "Rest of Greater Perth", 
                                                                                     "Other")
                                                                              )
                                              )


 
#drop non_Greater_Perth places of usual residence
LGA_UR_JTW_2016 <- LGA_UR_JTW_2016[!is.na(LGA_UR_JTW_2016$grouping),]
LGA_UR_JTW_2021 <- LGA_UR_JTW_2021[!is.na(LGA_UR_JTW_2021$grouping),]                      

```



## 2.3 JTW by LGA (usual residence) and LGA (place of work)
The same data tables were used as in Section 2.2 above, but this time the individual LGA POW rows were retained. The Heritage, North-south and Outer east groupings were added to the datasets as before, but a Place Of Work (POW) variable was also defined^[CBD (the City of Perth), the Rest of Greater Perth, and other places (rest of WA, rest of Australia).].

```{r load_abs_2021_2016_destination_zones_correspondence_SA1_and_DZ, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=TRUE, fig.cap="Perth 2021 destination zonea", cache=TRUE}


####Next add the JTW data by DZ and LGA
## by Year and DZ and LGA data from ABS comes in a single file, with multiple CSV sections for each LGA. I found https://pypi.org/project/table_builder_io/ which deals with this issue over in python. 
##adapted from https://github.com/vlc/table_builder_io/ code in python
#from table_builder_io import TableBuilderReader
# Load python and pandas
#reader = TableBuilderReader.from_file("/Users/julianreynolds/Documents/work/Monash University/Greater_Perth_JTW_by_DZ_and_LGA_2021.csv")
#df = reader.read_table(as_index=True)
#df2 = reader.read(as_index=False)

##then from https://stackoverflow.com/a/55168518
#for i in df2: 
#   df2[i].to_csv('dataframe_id_'+str(i)+'.csv')
##All of this results in an output of everything in a separated CSV for each LGA. 
##Some stuffing around required as python does not play well with '0's and / etc in file names


#Load JTW by LGA (usual residence) and LGA (place of work)
list_csv_files <- list.files(path = "01 data/2016", full.names = TRUE)
LGA_UR_LGA_POW_JTW_2016 <- readr::read_csv(list_csv_files, id = "file_name")
list_csv_files <- list.files(path = "01 data/2021", full.names = TRUE)
LGA_UR_LGA_POW_JTW_2021 <- readr::read_csv(list_csv_files, id = "file_name")

#Extract LGA name from filename field
LGA_UR_LGA_POW_JTW_2016$lga_name_2016 <- sub(".*dataframe_id_","", LGA_UR_LGA_POW_JTW_2016$file_name)
LGA_UR_LGA_POW_JTW_2016$lga_name_2016 <- sub(".csv.*","", LGA_UR_LGA_POW_JTW_2016$lga_name_2016)
LGA_UR_LGA_POW_JTW_2021$lga_name_2021 <- sub(".*dataframe_id_","", LGA_UR_LGA_POW_JTW_2021$file_name)
LGA_UR_LGA_POW_JTW_2021$lga_name_2021 <- sub(".csv.*","", LGA_UR_LGA_POW_JTW_2021$lga_name_2021)

#clean names
LGA_UR_LGA_POW_JTW_2016 <- clean_names(LGA_UR_LGA_POW_JTW_2016)
LGA_UR_LGA_POW_JTW_2021 <- clean_names(LGA_UR_LGA_POW_JTW_2021)

#remove total rows
LGA_UR_LGA_POW_JTW_2016 <- LGA_UR_LGA_POW_JTW_2016 %>% filter(lga_pow  != "Total")
LGA_UR_LGA_POW_JTW_2021 <- LGA_UR_LGA_POW_JTW_2021 %>% filter(lga_pow  != "Total")

#remove unneeded column and set so that column names are consistent
##assume that 2021 LGAs are the same as 2016 LGAs
LGA_UR_LGA_POW_JTW_2016 <- tibble (lga_name_2021 = LGA_UR_LGA_POW_JTW_2016$lga_name_2016, LGA_UR_LGA_POW_JTW_2016[,3:19])
LGA_UR_LGA_POW_JTW_2021 <- tibble (lga_name_2021 = LGA_UR_LGA_POW_JTW_2021$lga_name_2021, LGA_UR_LGA_POW_JTW_2021[,3:19])

#Set 2021 column names to match 2016 column names
names(LGA_UR_LGA_POW_JTW_2021) <- c("lga_name_2021", "lga_pow", "train", "bus", "ferry", "tram", "taxi", "car_as_driver", "car_as_passenger", "truck", "motorbike_scooter", "bicycle", "other_mode",    "walked_only", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")    

```

The Heritage, North-south and Outer east groupings were added to the datasets. A Place Of Work (POW) variable was also defined^[CBD (the City of Perth), the Rest of Greater Perth, and other places (rest of WA, rest of Australia).].
```{r add_groupings, echo=FALSE, fig.margin=TRUE, fig.cap="Perth 2021 destination zonea", cache=TRUE}
LGA_to_group <- tibble(lga_name_2021 = 
c("Melville", "South Perth", "Stirling", "Joondalup", "Wanneroo", "Cockburn", "Kwinana", "Rockingham", "Murray", "Mandurah",
  "Bayswater", "Belmont", "Canning","Fremantle", "Nedlands", "Perth", "Subiaco", "Vincent", "Peppermint Grove", "Bassendean", "Cambridge", "Claremont", "Cottesloe", "East Fremantle", "Mosman Park", "Victoria Park","Gosnells",
  "Kalamunda", "Swan", "Mundaring", "Armadale", "Serpentine-Jarrahdale", "Northam", "York"),
grouping = c("North-south", "North-south","North-south","North-south","North-south","North-south","North-south","North-south","North-south","North-south", "Heritage", "Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage","Heritage", "Outer-east", "Outer-east","Outer-east","Outer-east","Outer-east", "Outer-east","Outer-east")
)

#join grouping to JTW data frames
LGA_UR_LGA_POW_JTW_2016 <- left_join(LGA_UR_LGA_POW_JTW_2016, LGA_to_group, by = "lga_name_2021")
LGA_UR_LGA_POW_JTW_2021 <- left_join(LGA_UR_LGA_POW_JTW_2021, LGA_to_group, by = "lga_name_2021")


#Define place of work destination groupings
LGA_UR_LGA_POW_JTW_2016$place_of_work <- with(LGA_UR_LGA_POW_JTW_2016, ifelse(LGA_UR_LGA_POW_JTW_2016$lga_pow == "Perth", 
                                                                              "CBD", 
                                                                              ifelse(LGA_UR_LGA_POW_JTW_2016$lga_pow %in% LGA_to_group$lga_name_2021, 
                                                                                     "Rest of Greater Perth", 
                                                                                     "Other")
                                                                              )
                                              )

 #Define place of work destination groupings
LGA_UR_LGA_POW_JTW_2021$place_of_work <- with(LGA_UR_LGA_POW_JTW_2021, ifelse(LGA_UR_LGA_POW_JTW_2021$lga_pow == "Perth", 
                                                                              "CBD", 
                                                                              ifelse(LGA_UR_LGA_POW_JTW_2021$lga_pow %in% LGA_to_group$lga_name_2021, 
                                                                                     "Rest of Greater Perth", 
                                                                                     "Other")
                                                                              )
                                              )


 
#drop non_Greater_Perth places of usual residence
LGA_UR_LGA_POW_JTW_2016 <- LGA_UR_LGA_POW_JTW_2016[!is.na(LGA_UR_LGA_POW_JTW_2016$grouping),]
LGA_UR_LGA_POW_JTW_2021 <- LGA_UR_LGA_POW_JTW_2021[!is.na(LGA_UR_LGA_POW_JTW_2021$grouping),]                      

```

## 2.4 Population and employment data

The age and employment data was also obtained so that population and employed population changes can be calculated for each of the Heritage, North-south and Outer east groupings^[See 2016_WA_Age_by_LGA.csv, 2021_WA_Age_by_LGA.csv, 2016_WA_employment_by_LGA.csv, 2021_WA_employment_by_LGA.csv.]. Note that the employment figures include all people who are employed or studying^[See definitions at https://www.abs.gov.au/census/guide-census-data/census-dictionary/2021/variables-topic/education-and-training/engagement-employment-education-and-training-eetp].

```{r load_employment_and_age_data_SA1_and_DZ, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.cap="Greater Perth: Heritage, North-south and Outer East groupings", cache=TRUE}

library(readr)
X2016_WA_age_by_LGA <- read_csv("01 data/2016_WA_Age_by_LGA.csv", skip = 8)
X2016_WA_employment_by_LGA <- read_csv("01 data/2016_WA_employment_by_LGA.csv", skip=8)
X2021_WA_age_by_LGA <- read_csv("01 data/2021_WA_Age_by_LGA.csv", skip=8)
X2021_WA_employment_by_LGA <- read_csv("01 data/2021_WA_Employment_by_LGA.csv", skip=8)

#drop empty first row and last 5 rows, and last 2 columns
X2016_WA_age_by_LGA <- X2016_WA_age_by_LGA[2:(nrow(X2016_WA_age_by_LGA)-5), 1:(ncol(X2016_WA_age_by_LGA)-2)]
X2016_WA_employment_by_LGA <- X2016_WA_employment_by_LGA[2:(nrow(X2016_WA_employment_by_LGA)-5), 1:(ncol(X2016_WA_employment_by_LGA)-2)]
X2021_WA_age_by_LGA <- X2021_WA_age_by_LGA[2:(nrow(X2021_WA_age_by_LGA)-5), 1:(ncol(X2021_WA_age_by_LGA)-2)]
X2021_WA_employment_by_LGA <- X2021_WA_employment_by_LGA[2:(nrow(X2021_WA_employment_by_LGA)-5), 1:(ncol(X2021_WA_employment_by_LGA)-2)]

#set characters to numeric for column two
#Whoops, downloaded the by individual years data instead of the 10 year groupings
X2016_WA_age_by_LGA$`0 years` <- as.numeric(unlist(X2016_WA_age_by_LGA[,2]))
X2016_WA_employment_by_LGA$`Fully engaged`<- as.numeric(unlist(X2016_WA_employment_by_LGA[,2]))
X2021_WA_age_by_LGA$`0-9 years` <- as.numeric(unlist(X2021_WA_age_by_LGA[,2]))
X2021_WA_employment_by_LGA$`Fully engaged`<- as.numeric(unlist(X2021_WA_employment_by_LGA[,2]))

#set names the same
names(X2016_WA_age_by_LGA) <- 
  c("lga_name_2021", 
    names(X2016_WA_age_by_LGA[,2:ncol(X2016_WA_age_by_LGA)]))
names(X2016_WA_employment_by_LGA) <- 
  c("lga_name_2021", 
    names(X2016_WA_employment_by_LGA[,2:ncol(X2016_WA_employment_by_LGA)]))
names(X2021_WA_age_by_LGA) <- 
  c("lga_name_2021", 
    names(X2021_WA_age_by_LGA[,2:ncol(X2021_WA_age_by_LGA)]))
names(X2021_WA_employment_by_LGA) <- 
  c("lga_name_2021", 
    names(X2021_WA_employment_by_LGA[,2:ncol(X2021_WA_employment_by_LGA)]))


#Remove (C) and similar from lga names
X2016_WA_age_by_LGA$lga_name_2021 <- sub(" (*).*","", X2016_WA_age_by_LGA$lga_name_2021)
X2016_WA_employment_by_LGA$lga_name_2021 <- sub(" (*).*","", X2016_WA_employment_by_LGA$lga_name_2021)
X2021_WA_age_by_LGA$lga_name_2021 <- sub(" (*).*","", X2021_WA_age_by_LGA$lga_name_2021)
X2021_WA_employment_by_LGA$lga_name_2021 <- sub(" (*).*","", X2021_WA_employment_by_LGA$lga_name_2021)

#join grouping to employment and age data frames
X2016_WA_age_by_LGA <- left_join(X2016_WA_age_by_LGA, LGA_to_group, by = "lga_name_2021")
X2016_WA_employment_by_LGA <- left_join(X2016_WA_employment_by_LGA, LGA_to_group, by = "lga_name_2021")
X2021_WA_age_by_LGA <- left_join(X2021_WA_age_by_LGA, LGA_to_group, by = "lga_name_2021")
X2021_WA_employment_by_LGA <- left_join(X2021_WA_employment_by_LGA, LGA_to_group, by = "lga_name_2021")


```



# 3.0 Results

## 3.1 Aggregate for Greater Perth

The following shows aggregate results for all people whose usual residence was within Greater Perth at the time of each census. Looking at the population and employment^[Note that the employment numbers include people who are engaged in employment and study.] numbers:



```{r Population_and_employment_Greater_Perth, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Greater Perth, population and employment, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in perth
Aggregate_UR_2016_2021 <- (X2016_WA_age_by_LGA %>% adorn_totals(where = c("row","col")))[nrow(X2016_WA_age_by_LGA)+1,"Total"]
Aggregate_UR_2016_2021 <- add_row(Aggregate_UR_2016_2021, (X2021_WA_age_by_LGA %>% adorn_totals(where = c("row","col")))[nrow(X2021_WA_age_by_LGA)+1,"Total"])

#calculate aggregates for everyone who is emplyed with a usual residence in perth
Aggregate_employed_UR_2016_2021 <- (X2016_WA_employment_by_LGA[,c("lga_name_2021","Fully engaged", "Partially engaged", "At least partially engaged")] %>% adorn_totals(where = c("row","col")))[nrow(X2016_WA_employment_by_LGA)+1,"Total"]


Aggregate_employed_UR_2016_2021 <- add_row(Aggregate_employed_UR_2016_2021, (X2021_WA_employment_by_LGA[,c("lga_name_2021","Fully engaged", "Partially engaged", "At least partially engaged")] %>% adorn_totals(where = c("row","col")))                                                                      [nrow(X2021_WA_employment_by_LGA)+1,"Total"])


Aggregate_pop_and_employed_UR_2016_2021 <- tibble(Year = c("2016","2021"))
Aggregate_pop_and_employed_UR_2016_2021$Population <- Aggregate_UR_2016_2021$Total
Aggregate_pop_and_employed_UR_2016_2021$Employed <- Aggregate_employed_UR_2016_2021$Total


kable(Aggregate_pop_and_employed_UR_2016_2021, caption = "Population and employed population, Greater Perth, 2016 and 2021"
)

#calcluate change and percent change
Aggregate_pop_and_employed_UR_2016_2021_change <- tibble(
  "-" = c("Change", "Percent change"), Population = c(1,1), Employed = c(2,2))
Aggregate_pop_and_employed_UR_2016_2021_change[1,"Population"] <- 
    Aggregate_pop_and_employed_UR_2016_2021[2,2] - Aggregate_pop_and_employed_UR_2016_2021[1,2]
Aggregate_pop_and_employed_UR_2016_2021_change[1,"Employed"] <- 
    Aggregate_pop_and_employed_UR_2016_2021[2,3] - Aggregate_pop_and_employed_UR_2016_2021[1,3]
Aggregate_pop_and_employed_UR_2016_2021_change[2,"Population"] <- Aggregate_pop_and_employed_UR_2016_2021[2,2] / Aggregate_pop_and_employed_UR_2016_2021[1,2]-1
Aggregate_pop_and_employed_UR_2016_2021_change[2,"Employed"] <- Aggregate_pop_and_employed_UR_2016_2021[2,3] / Aggregate_pop_and_employed_UR_2016_2021[1,3]-1

```

The population rose by `r format(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[1,2]), big.mark=",", scientific=FALSE)` (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,2]))`), while the number of people employed and/or studying increased by `r format(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[1,3]), big.mark=",", scientific=FALSE)` (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,3]))`).



```{r Greater_Perth_JTW_aggregate, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="People with a usual residence in Greater Perth, journey to work mode share, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in perth
Aggregate_JTW_2016_2021 <- add_row(Greater_Perth_UR_JTW_2016, Greater_Perth_UR_JTW_2021)

Aggregate_JTW_2016_2021$Year <- c("2016", "2021")

#combine modes to obtain PT, private vehicle (drive), private vehicle (passenger)  and non-motorised columns
Aggregate_JTW_2016_2021$private_vehicle_drive <- Aggregate_JTW_2016_2021$car_as_driver + Aggregate_JTW_2016_2021$truck + Aggregate_JTW_2016_2021$motorbike_scooter  

Aggregate_JTW_2016_2021$private_vehicle_passenger <- Aggregate_JTW_2016_2021$car_as_passenger + Aggregate_JTW_2016_2021$taxi  

Aggregate_JTW_2016_2021$transit <- Aggregate_JTW_2016_2021$train + Aggregate_JTW_2016_2021$bus + Aggregate_JTW_2016_2021$ferry + Aggregate_JTW_2016_2021$tram

Aggregate_JTW_2016_2021$non_motorised <- Aggregate_JTW_2016_2021$bicycle + Aggregate_JTW_2016_2021$walked_only

#Summarise all, including did not work, not stated and not applicable
kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns()
)




#pivot_longer 
Aggregate_JTW_2016_2021_summary_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")], 
  cols = c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home"), 
  names_to = "Mode or activity",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_summary_longer$`Mode or activity` <- factor( Aggregate_JTW_2016_2021_summary_longer$`Mode or activity`, levels = c("worked_at_home", "other_mode", "non_motorised", "transit", "private_vehicle_passenger", "private_vehicle_drive"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_summary_longer[,], 
  x = `Mode or activity`,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode/activity shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)


```


A Pearson's chi-squared test indicated that the relationship between census and JTW activity/mode was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]))`.


The largest increase was in the number of people who drove a private vehicle (+`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]))`, +`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"])-1)`). The rate of increase in driving was at a higher rate than population growth (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,2]))`) and than the rate of growth in people employed or engaged in study (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,3]))`). However, the overall drive mode share dropped by a small amount(`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`).


The number of people who worked from home also increased by a large amount, more than doubling to `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]))` (+`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])-as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])/as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"])-1)`). WFH share increased by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`. 


The number of people who commuted as a passenger in a private vehicle increased by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]))`(+`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"])-1)`). Again, the rate of this increase is much larger than the rate of increase in population (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,2]))`) and than the rate of increase in the number of people who were employed and/or studying (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,3]))`). However, passenger mode share was relatively stable, only increasing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 


The use of non-motorised modes dropped, with the number of people cycling and walking falling by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])-as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])/as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])-1)`). The non-motorised mode share also fell by a small amount (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`).

Transit ridership fell (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])/as.numeric(Aggregate_JTW_2016_2021[1,"transit"])-1)`) as did the transit mode share (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"transit"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"transit"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`). The following summarizes the changes amongst the individual transit modes: 


```{r Transit_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Greater Perth, journey to work mode share by train and bus, 2021 and 2016 censuses"}


#pivot_longer 
Aggregate_JTW_2016_2021_transit_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "train", "bus", "ferry")], 
  cols = c("train", "bus", "ferry"), 
  names_to = "Mode",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_transit_longer$Mode <- factor(Aggregate_JTW_2016_2021_transit_longer$Mode, levels = c("train", "bus", "ferry", "tram"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_transit_longer[,], 
  x = Mode,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares for transit, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)

#kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram", "private_vehicle_drive", "private_vehicle_passenger", "non_motorised", "other_mode", "worked_at_home" )]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable")



```

A Pearson's chi-squared test indicated that the relationship between census and the shares of train, bus and ferry ridership was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("train", "bus", "ferry")]))`.

The number of people who used the train fell by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])-as.numeric(Aggregate_JTW_2016_2021[1,"train"])))`(`r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])/as.numeric(Aggregate_JTW_2016_2021[1,"train"])-1))`). Train ridership as a share of transit ridership decreased by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. The overall train mode share also dropped (by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`).

Bus ridership fell by a similar amount (`r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])-as.numeric(Aggregate_JTW_2016_2021[1,"bus"])))`, `r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])/as.numeric(Aggregate_JTW_2016_2021[1,"bus"])-1))`), but bus ridership rose as a share of transit ridership by `r label_percent(accuracy = 0.1)((as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. The overall bus mode share fell by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.



## 3.2 Disaggregate
The following sections discuss the changes in JTW commute mode/activity for people whose usual residence was in the eith the Heritiage, the North-south or the Outer-east groupings of LGAs. 

### 3.2.1 Heritage grouping

Changes in the population and population engaged in employment and/or study within the Heritage grouping of LGAs between the 2016 and 2021 censuses are as follows: 

```{r Population_and_employment_Heritage, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Greater Perth, population and employment, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in group
Aggregate_UR_2016_2021 <- (X2016_WA_age_by_LGA %>% filter(grouping == "Heritage") %>% adorn_totals(where = c("row","col")))[nrow(X2016_WA_age_by_LGA %>% filter(grouping == "Heritage"))+1,"Total"]
Aggregate_UR_2016_2021 <- add_row(Aggregate_UR_2016_2021, (X2021_WA_age_by_LGA %>% filter(grouping == "Heritage") %>% adorn_totals(where = c("row","col")))[nrow(X2021_WA_age_by_LGA %>% filter(grouping == "Heritage"))+1,"Total"])

#calculate aggregates for everyone who is emplyed with a usual residence in group
Aggregate_employed_UR_2016_2021 <- ((X2016_WA_employment_by_LGA %>% filter(grouping == "Heritage")
                                     )[,c("lga_name_2021","Fully engaged", "Partially engaged", "At least partially engaged")] %>% 
                                      adorn_totals(where = c("row","col")))[nrow(X2016_WA_employment_by_LGA %>% filter(grouping == "Heritage"))+1,"Total"]


Aggregate_employed_UR_2016_2021 <- add_row(Aggregate_employed_UR_2016_2021, 
                                           ((X2021_WA_employment_by_LGA %>% filter(grouping == "Heritage")
                                     )[,c("lga_name_2021","Fully engaged", "Partially engaged", "At least partially engaged")] %>% 
                                      adorn_totals(where = c("row","col")))[nrow(X2021_WA_employment_by_LGA %>% filter(grouping == "Heritage"))+1,"Total"])



Aggregate_pop_and_employed_UR_2016_2021 <- tibble(Year = c("2016","2021"))
Aggregate_pop_and_employed_UR_2016_2021$Population <- Aggregate_UR_2016_2021$Total
Aggregate_pop_and_employed_UR_2016_2021$Employed <- Aggregate_employed_UR_2016_2021$Total


kable(Aggregate_pop_and_employed_UR_2016_2021, caption = "Population and employed population, Heritage grouping, 2016 and 2021"
)

#calcluate change and percent change
Aggregate_pop_and_employed_UR_2016_2021_change <- tibble(
  "-" = c("Change", "Percent change"), Population = c(1,1), Employed = c(2,2))
Aggregate_pop_and_employed_UR_2016_2021_change[1,"Population"] <- 
    Aggregate_pop_and_employed_UR_2016_2021[2,2] - Aggregate_pop_and_employed_UR_2016_2021[1,2]
Aggregate_pop_and_employed_UR_2016_2021_change[1,"Employed"] <- 
    Aggregate_pop_and_employed_UR_2016_2021[2,3] - Aggregate_pop_and_employed_UR_2016_2021[1,3]
Aggregate_pop_and_employed_UR_2016_2021_change[2,"Population"] <- Aggregate_pop_and_employed_UR_2016_2021[2,2] / Aggregate_pop_and_employed_UR_2016_2021[1,2]-1
Aggregate_pop_and_employed_UR_2016_2021_change[2,"Employed"] <- Aggregate_pop_and_employed_UR_2016_2021[2,3] / Aggregate_pop_and_employed_UR_2016_2021[1,3]-1


#kable(Aggregate_pop_and_employed_UR_2016_2021_change, caption = "Population and employed population changes, Heritage grouping, 2016 and 2021")




```

The population of the Heritage grouping of LGAs rose by `r format(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[1,2]), big.mark=",", scientific=FALSE)` (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,2]))`), while the number of people employed and/or studying increased by `r format(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[1,3]), big.mark=",", scientific=FALSE)` (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,3]))`).

```{r Heritage_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Heritage grouping, journey to work mode share, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in perth
Aggregate_JTW_2016_2021 <- tibble(LGA_UR_JTW_2016 %>% filter(grouping == "Heritage") %>% adorn_totals() %>% tail(n=1))
Aggregate_JTW_2016_2021 <- add_row(Aggregate_JTW_2016_2021, LGA_UR_JTW_2021 %>% filter(grouping == "Heritage") %>% adorn_totals() %>% tail(n=1))

Aggregate_JTW_2016_2021$Year <- c("2016", "2021")

#combine modes to obtain PT, private vehicle (drive), private vehicle (passenger)  and non-motorised columns
Aggregate_JTW_2016_2021$private_vehicle_drive <- Aggregate_JTW_2016_2021$car_as_driver + Aggregate_JTW_2016_2021$truck + Aggregate_JTW_2016_2021$motorbike_scooter  

Aggregate_JTW_2016_2021$private_vehicle_passenger <- Aggregate_JTW_2016_2021$car_as_passenger + Aggregate_JTW_2016_2021$taxi  

Aggregate_JTW_2016_2021$transit <- Aggregate_JTW_2016_2021$train + Aggregate_JTW_2016_2021$bus + Aggregate_JTW_2016_2021$ferry + Aggregate_JTW_2016_2021$tram

Aggregate_JTW_2016_2021$non_motorised <- Aggregate_JTW_2016_2021$bicycle + Aggregate_JTW_2016_2021$walked_only

#Summarise all, including did not work, not stated and not applicable
kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns()
)




#pivot_longer 
Aggregate_JTW_2016_2021_summary_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")], 
  cols = c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home"), 
  names_to = "Mode or activity",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_summary_longer$`Mode or activity` <- factor( Aggregate_JTW_2016_2021_summary_longer$`Mode or activity`, levels = c("worked_at_home", "other_mode", "non_motorised", "transit", "private_vehicle_passenger", "private_vehicle_drive"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_summary_longer[,], 
  x = `Mode or activity`,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode/activity shares, persons with a usual residence in the Heritage grouping, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)


```


A Pearson's chi-squared test indicated that the relationship between census and JTW activity/mode was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]))`.


The number of people whose usual residence is in the Heritage grouping of LGAs and who commuted in a private vehicle as the driver increased by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]))`(+`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"])-1)`). This rate is higher than that of population growth (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,2]))`), but slightly lower than the growth in people who are employed or studying (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,3]))`). However, the drive mode share dropped slightly (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`) to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.




The number of people whose usuual residence is in the Heritage grouping of LGas who worked from home increased by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])-as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])/as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"])-1)`). WFH share increased by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

The rate of increase in the number of people whose usual residence is in the Heritage grouping of LGAs who commuted as a passenger in a private vehicle (+`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"])-1)`, +`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]))` people) was roughly twice the rate of the increase in the number of people who were employed or studying (+`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,3]))`).  However, overall passenger mode share only increased by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 


Transit ridership fell slightly (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])/as.numeric(Aggregate_JTW_2016_2021[1,"transit"])-1)`), with transit mode share also dropping (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"transit"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"transit"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`). The following shows changes in ridership amongst each transit mode:



```{r Heritage_transit_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Heritage grouping, journey to work mode share for transit, 2021 and 2016 censuses"}


#pivot_longer 
Aggregate_JTW_2016_2021_transit_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "train", "bus", "ferry")], 
  cols = c("train", "bus", "ferry"), 
  names_to = "Mode",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_transit_longer$Mode <- factor(Aggregate_JTW_2016_2021_transit_longer$Mode, levels = c("train", "bus", "ferry", "tram"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_transit_longer[,], 
  x = Mode,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares for transit, persons with a usual residence in Heritage grouping, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)

#kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram", "private_vehicle_drive", "private_vehicle_passenger", "non_motorised", "other_mode", "worked_at_home" )]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work transit mode shares, persons with a usual residence in Heritage grouping, 2016 and 2021 censuses")



```


A Pearson's chi-squared test indicated that the relationship between census and the share of train-to-bus ridership was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("train", "bus")]))`.

Despite the fall in overall transit ridership (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"]))`), the number of commuters living in the Heritage grouping who used the bus rose by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])-as.numeric(Aggregate_JTW_2016_2021[1,"bus"]))` (`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])/as.numeric(Aggregate_JTW_2016_2021[1,"bus"])-1)`). Bus ridership rose as a share of transit ridership by `r label_percent(accuracy = 0.1)((as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. However, the overall bus mode share fell by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

The number of people who used the train fell by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])-as.numeric(Aggregate_JTW_2016_2021[1,"train"])))`(`r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])/as.numeric(Aggregate_JTW_2016_2021[1,"train"])-1))`). Train ridership as a share of transit ridership also fell, dropping `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. The overall train mode share dropped by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

Notably, the drop in the number of people commuting by non-motorised modes (walk or bike) was `r label_number(big.mark = ",", accuracy = 0.1)((as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])-as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]))/(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"])))` times larger than the loss in transit ridership, with `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])-as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])))` fewer people walking or cycling to work in 2021 than in 2016 (equating to a fall of `r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])/as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])-1))`). Non-motorised mode share also dropped  to  `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`(`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`).

### 3.2.2 North-south grouping

The following shows results for all people whose usual residence was within the North-south grouping of LGAs. 


```{r Population_and_employment_north_south, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Greater Perth, population and employment, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in group
Aggregate_UR_2016_2021 <- (X2016_WA_age_by_LGA %>% filter(grouping == "North-south") %>% adorn_totals(where = c("row","col")))[nrow(X2016_WA_age_by_LGA %>% filter(grouping == "North-south"))+1,"Total"]
Aggregate_UR_2016_2021 <- add_row(Aggregate_UR_2016_2021, (X2021_WA_age_by_LGA %>% filter(grouping == "North-south") %>% adorn_totals(where = c("row","col")))[nrow(X2021_WA_age_by_LGA %>% filter(grouping == "North-south"))+1,"Total"])

#calculate aggregates for everyone who is emplyed with a usual residence in group
Aggregate_employed_UR_2016_2021 <- ((X2016_WA_employment_by_LGA %>% filter(grouping == "North-south")
                                     )[,c("lga_name_2021","Fully engaged", "Partially engaged", "At least partially engaged")] %>% 
                                      adorn_totals(where = c("row","col")))[nrow(X2016_WA_employment_by_LGA %>% filter(grouping == "North-south"))+1,"Total"]


Aggregate_employed_UR_2016_2021 <- add_row(Aggregate_employed_UR_2016_2021, 
                                           ((X2021_WA_employment_by_LGA %>% filter(grouping == "North-south")
                                     )[,c("lga_name_2021","Fully engaged", "Partially engaged", "At least partially engaged")] %>% 
                                      adorn_totals(where = c("row","col")))[nrow(X2021_WA_employment_by_LGA %>% filter(grouping == "North-south"))+1,"Total"])


Aggregate_pop_and_employed_UR_2016_2021 <- tibble(Year = c("2016","2021"))
Aggregate_pop_and_employed_UR_2016_2021$Population <- Aggregate_UR_2016_2021$Total
Aggregate_pop_and_employed_UR_2016_2021$Employed <- Aggregate_employed_UR_2016_2021$Total


kable(Aggregate_pop_and_employed_UR_2016_2021, caption = "Population and employed population, North-south grouping, 2016 and 2021"
)

#calcluate change and percent change
Aggregate_pop_and_employed_UR_2016_2021_change <- tibble(
  "-" = c("Change", "Percent change"), Population = c(1,1), Employed = c(2,2))
Aggregate_pop_and_employed_UR_2016_2021_change[1,"Population"] <- 
    Aggregate_pop_and_employed_UR_2016_2021[2,2] - Aggregate_pop_and_employed_UR_2016_2021[1,2]
Aggregate_pop_and_employed_UR_2016_2021_change[1,"Employed"] <- 
    Aggregate_pop_and_employed_UR_2016_2021[2,3] - Aggregate_pop_and_employed_UR_2016_2021[1,3]
Aggregate_pop_and_employed_UR_2016_2021_change[2,"Population"] <- Aggregate_pop_and_employed_UR_2016_2021[2,2] / Aggregate_pop_and_employed_UR_2016_2021[1,2]-1
Aggregate_pop_and_employed_UR_2016_2021_change[2,"Employed"] <- Aggregate_pop_and_employed_UR_2016_2021[2,3] / Aggregate_pop_and_employed_UR_2016_2021[1,3]-1


#kable(Aggregate_pop_and_employed_UR_2016_2021_change, caption = "Population and employed population changes, North-south grouping, 2016 and 2021")




```

The population of the North-south grouping of LGAs rose by `r format(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[1,2]), big.mark=",", scientific=FALSE)` (+`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,2]))`). The number of people employed and/or studying  whose usual residence was in the North-south grouping increased by `r format(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[1,3]), big.mark=",", scientific=FALSE)` (+`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,3]))`).

```{r North_South_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="North-south grouping, journey to work mode share, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in perth
Aggregate_JTW_2016_2021 <- tibble(LGA_UR_JTW_2016 %>% filter(grouping == "North-south") %>% adorn_totals() %>% tail(n=1))
Aggregate_JTW_2016_2021 <- add_row(Aggregate_JTW_2016_2021, LGA_UR_JTW_2021 %>% filter(grouping == "North-south") %>% adorn_totals() %>% tail(n=1))

Aggregate_JTW_2016_2021$Year <- c("2016", "2021")

#combine modes to obtain PT, private vehicle (drive), private vehicle (passenger)  and non-motorised columns
Aggregate_JTW_2016_2021$private_vehicle_drive <- Aggregate_JTW_2016_2021$car_as_driver + Aggregate_JTW_2016_2021$truck + Aggregate_JTW_2016_2021$motorbike_scooter  

Aggregate_JTW_2016_2021$private_vehicle_passenger <- Aggregate_JTW_2016_2021$car_as_passenger + Aggregate_JTW_2016_2021$taxi  

Aggregate_JTW_2016_2021$transit <- Aggregate_JTW_2016_2021$train + Aggregate_JTW_2016_2021$bus + Aggregate_JTW_2016_2021$ferry + Aggregate_JTW_2016_2021$tram

Aggregate_JTW_2016_2021$non_motorised <- Aggregate_JTW_2016_2021$bicycle + Aggregate_JTW_2016_2021$walked_only

#Summarise all, including did not work, not stated and not applicable
kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns()
)




#pivot_longer 
Aggregate_JTW_2016_2021_summary_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")], 
  cols = c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home"), 
  names_to = "Mode or activity",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_summary_longer$`Mode or activity` <- factor( Aggregate_JTW_2016_2021_summary_longer$`Mode or activity`, levels = c("worked_at_home", "other_mode", "non_motorised", "transit", "private_vehicle_passenger", "private_vehicle_drive"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_summary_longer[,], 
  x = `Mode or activity`,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode/activity shares, persons with a usual residence in the North-south grouping, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)


```


A Pearson's chi-squared test indicated that the relationship between census and JTW activity/mode was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]))`.


The number of people whose usual residence was in the North-south grouping of LGAs who drove a private vehicle for their commute increased  by `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"])-1)` (+`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]))`). This is between the rates of increase for population (+`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,2]))`) and for the number of people engaged in work and/or study (+`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,3]))`). However, overall drive mode share dropped by (`r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))`).



The number of people who worked from home increased by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])-as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]))`(+`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])/as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"])-1)`). WFH share increased by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`. 


The number of people who lived in the North-south grouping and commuted as a passenger in a private vehicle increased by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]))` (+`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"])-1)`). The rate of increase for commuting as a passenger was higher than both that of population growth (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,2]))`) and the rate of growth in the number of people engaged in employment and/or study in the North-south grouping of LGAs (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,3]))`). However, overall passenger mode share did not change (remaining at `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`). 

The number of people who used non-motorised modes dropped by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])-as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])))`(`r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])/as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])-1))`). Non-motorised mode share also fell (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`) to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.


Transit ridership amongst those whose usual residence was in the North-south group of LGAs dropped by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"])))`(`r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])/as.numeric(Aggregate_JTW_2016_2021[1,"transit"])-1))`). Transit mode share also dropped (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"transit"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"transit"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`). The following summarizes the mode split amongst those who used transit: 



```{r North_south_transit_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="North-south grouping, journey to work mode share by train, bus and ferry, 2021 and 2016 censuses"}


#pivot_longer 
Aggregate_JTW_2016_2021_transit_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "train", "bus", "ferry")], 
  cols = c("train", "bus", "ferry"), 
  names_to = "Mode",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_transit_longer$Mode <- factor(Aggregate_JTW_2016_2021_transit_longer$Mode, levels = c("train", "bus", "ferry", "tram"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_transit_longer[,], 
  x = Mode,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares for transit, persons with a usual residence in North-south grouping of LGAs, 2016 and 2021 censuses."
)

#kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram", "private_vehicle_drive", "private_vehicle_passenger", "non_motorised", "other_mode", "worked_at_home" )]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares, persons with a usual residence in North-south grouping, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable")



```

A Pearson's chi-squared test indicated that the relationship between census and the shares of train, bus and ferry ridership was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("train", "bus", "ferry")]))`.

The number of people who used the train fell by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])-as.numeric(Aggregate_JTW_2016_2021[1,"train"])))`(`r label_percent()((as.numeric(Aggregate_JTW_2016_2021[2,"train"])/as.numeric(Aggregate_JTW_2016_2021[1,"train"])-1))`). However, train ridership as a share of transit ridership increased by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. Overall, however, the train mode share dropped by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

Bus ridership amongst those with a usual residence within the North-south grouping of LGAs fell by a similar amount (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])-as.numeric(Aggregate_JTW_2016_2021[1,"bus"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])/as.numeric(Aggregate_JTW_2016_2021[1,"bus"])-1)`). Bus ridership fell as a share of transit ridership (`r label_percent(accuracy = 0.1)((as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"transit"]))))`) to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. The overall bus mode share also dropped, falling `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.



### 3.2.3 Outer-east grouping
The following shows results for all people whose usual residence was within the Outer-east grouping of LGAs. Changes in the population and the number of people engaged in work and/or study are shown in the following: 




```{r Population_and_employment_outer_east, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Outer-east grouping, population and employment, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in group
Aggregate_UR_2016_2021 <- (X2016_WA_age_by_LGA %>% filter(grouping == "North-south") %>% adorn_totals(where = c("row","col")))[nrow(X2016_WA_age_by_LGA %>% filter(grouping == "Outer-east"))+1,"Total"]
Aggregate_UR_2016_2021 <- add_row(Aggregate_UR_2016_2021, (X2021_WA_age_by_LGA %>% filter(grouping == "Outer-east") %>% adorn_totals(where = c("row","col")))[nrow(X2021_WA_age_by_LGA %>% filter(grouping == "Outer-east"))+1,"Total"])

#calculate aggregates for everyone who is emplyed with a usual residence in group
Aggregate_employed_UR_2016_2021 <- ((X2016_WA_employment_by_LGA %>% filter(grouping == "Outer-east")
                                     )[,c("lga_name_2021","Fully engaged", "Partially engaged", "At least partially engaged")] %>% 
                                      adorn_totals(where = c("row","col")))[nrow(X2016_WA_employment_by_LGA %>% filter(grouping == "Outer-east"))+1,"Total"]


Aggregate_employed_UR_2016_2021 <- add_row(Aggregate_employed_UR_2016_2021, 
                                           ((X2021_WA_employment_by_LGA %>% filter(grouping == "Outer-east")
                                     )[,c("lga_name_2021","Fully engaged", "Partially engaged", "At least partially engaged")] %>% 
                                      adorn_totals(where = c("row","col")))[nrow(X2021_WA_employment_by_LGA %>% filter(grouping == "Outer-east"))+1,"Total"])


Aggregate_pop_and_employed_UR_2016_2021 <- tibble(Year = c("2016","2021"))
Aggregate_pop_and_employed_UR_2016_2021$Population <- Aggregate_UR_2016_2021$Total
Aggregate_pop_and_employed_UR_2016_2021$Employed <- Aggregate_employed_UR_2016_2021$Total


kable(Aggregate_pop_and_employed_UR_2016_2021, caption = "Population and employed population, Outer-east, 2016 and 2021"
)

#calcluate change and percent change
Aggregate_pop_and_employed_UR_2016_2021_change <- tibble(
  "-" = c("Change", "Percent change"), Population = c(1,1), Employed = c(2,2))
Aggregate_pop_and_employed_UR_2016_2021_change[1,"Population"] <- 
    Aggregate_pop_and_employed_UR_2016_2021[2,2] - Aggregate_pop_and_employed_UR_2016_2021[1,2]
Aggregate_pop_and_employed_UR_2016_2021_change[1,"Employed"] <- 
    Aggregate_pop_and_employed_UR_2016_2021[2,3] - Aggregate_pop_and_employed_UR_2016_2021[1,3]
Aggregate_pop_and_employed_UR_2016_2021_change[2,"Population"] <- Aggregate_pop_and_employed_UR_2016_2021[2,2] / Aggregate_pop_and_employed_UR_2016_2021[1,2]-1
Aggregate_pop_and_employed_UR_2016_2021_change[2,"Employed"] <- Aggregate_pop_and_employed_UR_2016_2021[2,3] / Aggregate_pop_and_employed_UR_2016_2021[1,3]-1


#kable(Aggregate_pop_and_employed_UR_2016_2021_change, caption = "Population and employed population changes, Outer-east grouping, 2016 and 2021")




```

The population rose by `r format(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[1,2]), big.mark=",", scientific=FALSE)` (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,2]))`), while the number of people employed and/or studying increased by `r format(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[1,3]), big.mark=",", scientific=FALSE)` (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_pop_and_employed_UR_2016_2021_change[2,3]))`).





```{r Outer_east_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Outer-east grouping, journey to work mode share, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in perth
Aggregate_JTW_2016_2021 <- tibble(LGA_UR_JTW_2016 %>% filter(grouping == "Heritage") %>% adorn_totals() %>% tail(n=1))
Aggregate_JTW_2016_2021 <- add_row(Aggregate_JTW_2016_2021, LGA_UR_JTW_2021 %>% filter(grouping == "Heritage") %>% adorn_totals() %>% tail(n=1))

Aggregate_JTW_2016_2021$Year <- c("2016", "2021")

#combine modes to obtain PT, private vehicle (drive), private vehicle (passenger)  and non-motorised columns
Aggregate_JTW_2016_2021$private_vehicle_drive <- Aggregate_JTW_2016_2021$car_as_driver + Aggregate_JTW_2016_2021$truck + Aggregate_JTW_2016_2021$motorbike_scooter  

Aggregate_JTW_2016_2021$private_vehicle_passenger <- Aggregate_JTW_2016_2021$car_as_passenger + Aggregate_JTW_2016_2021$taxi  

Aggregate_JTW_2016_2021$transit <- Aggregate_JTW_2016_2021$train + Aggregate_JTW_2016_2021$bus + Aggregate_JTW_2016_2021$ferry + Aggregate_JTW_2016_2021$tram

Aggregate_JTW_2016_2021$non_motorised <- Aggregate_JTW_2016_2021$bicycle + Aggregate_JTW_2016_2021$walked_only

#Summarise all, including did not work, not stated and not applicable
kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns()
)




#pivot_longer 
Aggregate_JTW_2016_2021_summary_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")], 
  cols = c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home"), 
  names_to = "Mode or activity",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_summary_longer$`Mode or activity` <- factor( Aggregate_JTW_2016_2021_summary_longer$`Mode or activity`, levels = c("worked_at_home", "other_mode", "non_motorised", "transit", "private_vehicle_passenger", "private_vehicle_drive"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_summary_longer[,], 
  x = `Mode or activity`,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode/activity shares, persons with a usual residence in the Outer-east grouping, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)


```


A Pearson's chi-squared test indicated that the relationship between census and JTW activity/mode was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]))`.


The number of people who drove a private vehicle increased (+`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]))`, or by +`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"])-1)`), but the drive mode share dropped (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`).


The number of people who worked from home increased by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])-as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])/as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"])-1)`). WFH share also increased by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 



The number of people who were a passenger in a private vehicle increased by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"])-1)`), with passenger mode share also increasing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 


The number of people who used transit dropped slightly (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])/as.numeric(Aggregate_JTW_2016_2021[1,"transit"])-1)`). Transit mode share also dropped (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"transit"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"transit"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`). The following summarizes the mode split amongst those who used transit: 



```{r Outer_East_transit_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Outer-east grouping, journey to work mode share by train, bus and ferry, 2021 and 2016 censuses"}


#pivot_longer 
Aggregate_JTW_2016_2021_transit_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "train", "bus", "ferry")], 
  cols = c("train", "bus", "ferry"), 
  names_to = "Mode",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_transit_longer$Mode <- factor(Aggregate_JTW_2016_2021_transit_longer$Mode, levels = c("train", "bus", "ferry", "tram"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_transit_longer[,], 
  x = Mode,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares, persons with a usual residence in the Outer-east grouping, 2016 and 2021 censuses"
)

#kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram", "private_vehicle_drive", "private_vehicle_passenger", "non_motorised", "other_mode", "worked_at_home" )]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares, persons with a usual residence in the Outer-east grouping, 2016 and 2021 censuses")



```


A Pearson's chi-squared test indicated that the relationship between census and the shares of train, bus and ferry ridership was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("train", "bus", "ferry")]))`.

The number of people who used the train fell by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])-as.numeric(Aggregate_JTW_2016_2021[1,"train"])))`(`r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])/as.numeric(Aggregate_JTW_2016_2021[1,"train"])-1))`). Train ridership as a share of transit ridership also dropped, falling by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. The overall train mode share also dropped by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

Bus ridership amongst those with a usual residence within the Outer-east grouping of LGAs actually increased (+`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])-as.numeric(Aggregate_JTW_2016_2021[1,"bus"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])/as.numeric(Aggregate_JTW_2016_2021[1,"bus"])-1)`). Bus ridership rose as a share of transit ridership by `r label_percent(accuracy = 0.1)((as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"transit"])))`, but the overall bus mode share fell`r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.



Notably, the number of people who used non-motorised modes fell by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])-as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])/as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])-1)`), which is a large fall than for the train or for transit overall. The non-motorised mode share also dropped (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`).






## 3.3 Place of work - CBD

The following shows results for all people whose usual residence is within Greater Perth and whose place of work is within the (central) Perth LGA. 

```{r CBD_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Place of work in the (central) Perth LGA and usual residence in Greater Perth, journey to work mode share, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in perth
Aggregate_JTW_2016_2021 <- tibble(LGA_UR_LGA_POW_JTW_2016 %>% filter(place_of_work == "CBD") %>% adorn_totals() %>% tail(n=1))
Aggregate_JTW_2016_2021 <- add_row(Aggregate_JTW_2016_2021, LGA_UR_LGA_POW_JTW_2021 %>% filter(place_of_work == "CBD") %>% adorn_totals() %>% tail(n=1))

Aggregate_JTW_2016_2021$Year <- c("2016", "2021")

#combine modes to obtain PT, private vehicle (drive), private vehicle (passenger)  and non-motorised columns
Aggregate_JTW_2016_2021$private_vehicle_drive <- Aggregate_JTW_2016_2021$car_as_driver + Aggregate_JTW_2016_2021$truck + Aggregate_JTW_2016_2021$motorbike_scooter  

Aggregate_JTW_2016_2021$private_vehicle_passenger <- Aggregate_JTW_2016_2021$car_as_passenger + Aggregate_JTW_2016_2021$taxi  

Aggregate_JTW_2016_2021$transit <- Aggregate_JTW_2016_2021$train + Aggregate_JTW_2016_2021$bus + Aggregate_JTW_2016_2021$ferry + Aggregate_JTW_2016_2021$tram

Aggregate_JTW_2016_2021$non_motorised <- Aggregate_JTW_2016_2021$bicycle + Aggregate_JTW_2016_2021$walked_only

#Summarise all, including did not work, not stated and not applicable
kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns()
)




#pivot_longer 
Aggregate_JTW_2016_2021_summary_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")], 
  cols = c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home"), 
  names_to = "Mode or activity",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_summary_longer$`Mode or activity` <- factor( Aggregate_JTW_2016_2021_summary_longer$`Mode or activity`, levels = c("worked_at_home", "other_mode", "non_motorised", "transit", "private_vehicle_passenger", "private_vehicle_drive"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_summary_longer[,], 
  x = `Mode or activity`,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode/activity shares, persons with a usual residence in Greater Perth and place of work in the (central) Perth LGA, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)


```


A Pearson's chi-squared test indicated that the relationship between census and JTW activity/mode was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]))`.



The number of people whose place of work is in the (central) Perth LGA, but who worked from home on the day of the census increased by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])-as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])/as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"])-1)`). The WFH share increased by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 

The number of people who drove a private vehicle increased by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]))`(+`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"])-1)`). Drive mode share also increased (+`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`).

The number of people who were a passenger in a private vehicle increased by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"])-1)`), but the passenger mode share did not change. 



The number of people who used non-motorised modes did not change by much (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])-as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]))`,`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])/as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])-1)`). Non-motorised mode share also dropped by a small amount (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`).



Similarly, he number of people who used transit dropped slightly (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])/as.numeric(Aggregate_JTW_2016_2021[1,"transit"])-1)`). However, transit share dropped by a relatively large amount (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"transit"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"transit"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`). The following shows the changes in train, bus and ferry ridership:



```{r CBD_Transit_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Place of work in (central) Perth LGA and usual residence in Greater Perth, journey to work mode share by train, bus and ferry, 2021 and 2016 censuses"}


#pivot_longer 
Aggregate_JTW_2016_2021_transit_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "train", "bus", "ferry")], 
  cols = c("train", "bus", "ferry"), 
  names_to = "Mode",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_transit_longer$Mode <- factor(Aggregate_JTW_2016_2021_transit_longer$Mode, levels = c("train", "bus", "ferry", "tram"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_transit_longer[,], 
  x = Mode,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work shares for each transit mode, persons with a usual residence in Greater Perth and place of work in the (central) Perth LGA, 2016 and 2021 censuses"
)

#kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram", "private_vehicle_drive", "private_vehicle_passenger", "non_motorised", "other_mode", "worked_at_home" )]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares for transit, persons with a usual residence in Greater Perth and place of work in the (central) Perth LGA, 2016 and 2021 censuses")



```


A Pearson's chi-squared test indicated that the relationship between census and the shares of train, bus and ferry ridership was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("train", "bus", "ferry")]))`.

The number of people who used the train fell by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])-as.numeric(Aggregate_JTW_2016_2021[1,"train"])))`(`r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])/as.numeric(Aggregate_JTW_2016_2021[1,"train"])-1))`). Train ridership as a share of transit ridership also fell (by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"transit"])))`). The overall train mode share likewise dropped by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

Perhaps unexpectedly, bus ridership actually rose by (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])-as.numeric(Aggregate_JTW_2016_2021[1,"bus"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])/as.numeric(Aggregate_JTW_2016_2021[1,"bus"])-1)`) for those whose place of work was within the (central) Perth LGA. Bus ridership also rose as a share of transit ridership by `r label_percent(accuracy = 0.1)((as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. However, the overall bus mode share fell `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

THe next sections examine the changes for people whose place of work was within the (central) Perth LGA in more detail, looking at those who usually lived in the Heritage, North-south and Outer-east groupings in tern. 
### 3.3.1 Place of Work:City of Perth; usual residence: Heritage grouping


The following shows results for all people whose usual residence is within the Heritage grouping of LGAs and whose place of work is within the (central) Perth LGA. 

```{r Heritage_CBD_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Heritage grouping, central Perth place of work, journey to work mode share, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in perth
Aggregate_JTW_2016_2021 <- tibble(LGA_UR_LGA_POW_JTW_2016 %>% filter(place_of_work == "CBD") %>% filter(grouping == "Heritage") %>% adorn_totals() %>% tail(n=1))
Aggregate_JTW_2016_2021 <- add_row(Aggregate_JTW_2016_2021, LGA_UR_LGA_POW_JTW_2021 %>% filter(place_of_work == "CBD") %>% filter(grouping == "Heritage") %>% adorn_totals() %>% tail(n=1))

Aggregate_JTW_2016_2021$Year <- c("2016", "2021")

#combine modes to obtain PT, private vehicle (drive), private vehicle (passenger)  and non-motorised columns
Aggregate_JTW_2016_2021$private_vehicle_drive <- Aggregate_JTW_2016_2021$car_as_driver + Aggregate_JTW_2016_2021$truck + Aggregate_JTW_2016_2021$motorbike_scooter  

Aggregate_JTW_2016_2021$private_vehicle_passenger <- Aggregate_JTW_2016_2021$car_as_passenger + Aggregate_JTW_2016_2021$taxi  

Aggregate_JTW_2016_2021$transit <- Aggregate_JTW_2016_2021$train + Aggregate_JTW_2016_2021$bus + Aggregate_JTW_2016_2021$ferry + Aggregate_JTW_2016_2021$tram

Aggregate_JTW_2016_2021$non_motorised <- Aggregate_JTW_2016_2021$bicycle + Aggregate_JTW_2016_2021$walked_only

#Summarise all, including did not work, not stated and not applicable
kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns()
)




#pivot_longer 
Aggregate_JTW_2016_2021_summary_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")], 
  cols = c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home"), 
  names_to = "Mode or activity",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_summary_longer$`Mode or activity` <- factor( Aggregate_JTW_2016_2021_summary_longer$`Mode or activity`, levels = c("worked_at_home", "other_mode", "non_motorised", "transit", "private_vehicle_passenger", "private_vehicle_drive"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_summary_longer[,], 
  x = `Mode or activity`,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode/activity shares, persons with a usual residence in the Heritage grouping and place of work in central Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)


```


A Pearson's chi-squared test indicated that the relationship between census and JTW activity/mode was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]))`.


The number of people who drove a private vehicle increased (+`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]))`, or by +`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"])-1)`). The drive mode share also increased (+`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`).



The number of people who worked from home increased by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])-as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]))`(+`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])/as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"])-1)`). The WFH share increased by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 



The number of people who were a passenger in a private vehicle increased by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"])-1)`). Passenger mode share also increased (+`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`). 



The number of people who used non-motorised modes increased by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])-as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])/as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])-1)`), but the non-motorised mode share dropped (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`). Similarly, the number of people who used transit increased by a relatively small amount `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])/as.numeric(Aggregate_JTW_2016_2021[1,"transit"])-1)`), while the overall mode share decreased . However, in the case of transit the mode share change was `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"transit"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"transit"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The following summarizes the mode split amongst those who used transit: 

```{r Heritage_CBD_Transit_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="People with a usual residence in the Heritage grouping and a place of work in central Perth, journey to work mode share by train, bus and ferry, 2021 and 2016 censuses"}


#pivot_longer 
Aggregate_JTW_2016_2021_transit_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "train", "bus", "ferry")], 
  cols = c("train", "bus", "ferry"), 
  names_to = "Mode",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_transit_longer$Mode <- factor(Aggregate_JTW_2016_2021_transit_longer$Mode, levels = c("train", "bus", "ferry", "tram"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_transit_longer[,], 
  x = Mode,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "People with a usual residence in the Heritage grouping and a place of work in central Perth, journey to work mode share by train, bus and ferry, 2021 and 2016 censuses"
)

#kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram", "private_vehicle_drive", "private_vehicle_passenger", "non_motorised", "other_mode", "worked_at_home" )]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "People with a usual residence in the Heritage grouping and a place of work in central Perth, journey to work overall mode share for train, bus and ferry, 2021 and 2016 censuses")



```


A Pearson's chi-squared test indicated that the relationship between census and the shares of train, bus and ferry ridership was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("train", "bus", "ferry")]))`.

The number of people who used the train fell by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])-as.numeric(Aggregate_JTW_2016_2021[1,"train"])))`(`r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])/as.numeric(Aggregate_JTW_2016_2021[1,"train"])-1))`). Train ridership as a share of transit ridership also decreased (by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"transit"])))`), while the overall train mode share dropped by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

Bus ridership actually increased (by`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])-as.numeric(Aggregate_JTW_2016_2021[1,"bus"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])/as.numeric(Aggregate_JTW_2016_2021[1,"bus"])-1)`) for those who lived in the Hertigate grouping of LGAs and had a place of work in central Perth. Bus ridership rose as a share of transit ridership by `r label_percent(accuracy = 0.1)((as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"transit"])))`, but the overall bus mode share fell by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.



### 3.3.2 Place of Work: City of Perth; usual residence: North-south grouping


HALT! BEYOND THIS POINT IS STILL UNDER CONSTRUCTION!!! 
READ NO FURTHER!!!


The following shows results for all people whose usual residence is within the North-south grouping of LGAs and whose place of work is within the (central) Perth LGA. 

```{r North_south_CBD_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="North-south grouping, CBD place of work, journey to work mode share, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in perth
Aggregate_JTW_2016_2021 <- tibble(LGA_UR_LGA_POW_JTW_2016 %>% filter(place_of_work == "CBD") %>% filter(grouping == "North-south") %>% adorn_totals() %>% tail(n=1))
Aggregate_JTW_2016_2021 <- add_row(Aggregate_JTW_2016_2021, LGA_UR_LGA_POW_JTW_2021 %>% filter(place_of_work == "CBD") %>% filter(grouping == "North-south") %>% adorn_totals() %>% tail(n=1))

Aggregate_JTW_2016_2021$Year <- c("2016", "2021")

#combine modes to obtain PT, private vehicle (drive), private vehicle (passenger)  and non-motorised columns
Aggregate_JTW_2016_2021$private_vehicle_drive <- Aggregate_JTW_2016_2021$car_as_driver + Aggregate_JTW_2016_2021$truck + Aggregate_JTW_2016_2021$motorbike_scooter  

Aggregate_JTW_2016_2021$private_vehicle_passenger <- Aggregate_JTW_2016_2021$car_as_passenger + Aggregate_JTW_2016_2021$taxi  

Aggregate_JTW_2016_2021$transit <- Aggregate_JTW_2016_2021$train + Aggregate_JTW_2016_2021$bus + Aggregate_JTW_2016_2021$ferry + Aggregate_JTW_2016_2021$tram

Aggregate_JTW_2016_2021$non_motorised <- Aggregate_JTW_2016_2021$bicycle + Aggregate_JTW_2016_2021$walked_only

#Summarise all, including did not work, not stated and not applicable
kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns()
)




#pivot_longer 
Aggregate_JTW_2016_2021_summary_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")], 
  cols = c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home"), 
  names_to = "Mode or activity",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_summary_longer$`Mode or activity` <- factor( Aggregate_JTW_2016_2021_summary_longer$`Mode or activity`, levels = c("worked_at_home", "other_mode", "non_motorised", "transit", "private_vehicle_passenger", "private_vehicle_drive"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_summary_longer[,], 
  x = `Mode or activity`,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode/activity shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)


```


A Pearson's chi-squared test indicated that the relationship between census and JTW activity/mode was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]))`.


The number of people who drove a private vehicle increased (+`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]))`, or by +`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"])-1)`), but the drive mode share dropped (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`).



The number of people who were a passenger in a private vehicle changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"])-1)`), with passenger mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 


The number of people who used transit changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])/as.numeric(Aggregate_JTW_2016_2021[1,"transit"])-1)`), with transit mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"transit"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"transit"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The following summarizes the mode split amongst those who used transit: 


The number of people who used non-motorised modes shifted by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])-as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])/as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])-1)`), with non-motorised mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`.



The number of people who worked from home changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])-as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])/as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"])-1)`), with WFH share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 


```{r North_south_CBD_Transit_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Greater Perth, journey to work mode share by train and bus, 2021 and 2016 censuses"}


#pivot_longer 
Aggregate_JTW_2016_2021_transit_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "train", "bus", "ferry")], 
  cols = c("train", "bus", "ferry"), 
  names_to = "Mode",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_transit_longer$Mode <- factor(Aggregate_JTW_2016_2021_transit_longer$Mode, levels = c("train", "bus", "ferry", "tram"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_transit_longer[,], 
  x = Mode,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares for transit, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram", "private_vehicle_drive", "private_vehicle_passenger", "non_motorised", "other_mode", "worked_at_home" )]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)



```


A Pearson's chi-squared test indicated that the relationship between census and the shares of train, bus and ferry ridership was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("train", "bus", "ferry")]))`.

The number of people who used the train fell by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])-as.numeric(Aggregate_JTW_2016_2021[1,"train"])))`(`r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])/as.numeric(Aggregate_JTW_2016_2021[1,"train"])-1))`). However, train ridership as a share of transit ridership increased by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. Overall, however, the train mode share dropped by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

Bus ridership amongst those with a usual residence within the North-south grouping of LGAs fell by a similar amount (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])-as.numeric(Aggregate_JTW_2016_2021[1,"bus"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])/as.numeric(Aggregate_JTW_2016_2021[1,"bus"])-1)`). Bus ridership rose as a share of transit ridership by `r label_percent(accuracy = 0.1)((as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. However, the bus mode share fell by only `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.


### 3.3.3 Place of Work: City of Perth; usual residence: Outer-east grouping

The following shows results for all people whose usual residence is within the Outer-east grouping of LGAs and whose place of work is within the (central) Perth LGA. 

```{r Outer_east_CBD_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="North-south grouping, CBD place of work, journey to work mode share, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in perth
Aggregate_JTW_2016_2021 <- tibble(LGA_UR_LGA_POW_JTW_2016 %>% filter(place_of_work == "CBD") %>% filter(grouping == "Outer-east") %>% adorn_totals() %>% tail(n=1))
Aggregate_JTW_2016_2021 <- add_row(Aggregate_JTW_2016_2021, LGA_UR_LGA_POW_JTW_2021 %>% filter(place_of_work == "CBD") %>% filter(grouping == "Outer-east") %>% adorn_totals() %>% tail(n=1))

Aggregate_JTW_2016_2021$Year <- c("2016", "2021")

#combine modes to obtain PT, private vehicle (drive), private vehicle (passenger)  and non-motorised columns
Aggregate_JTW_2016_2021$private_vehicle_drive <- Aggregate_JTW_2016_2021$car_as_driver + Aggregate_JTW_2016_2021$truck + Aggregate_JTW_2016_2021$motorbike_scooter  

Aggregate_JTW_2016_2021$private_vehicle_passenger <- Aggregate_JTW_2016_2021$car_as_passenger + Aggregate_JTW_2016_2021$taxi  

Aggregate_JTW_2016_2021$transit <- Aggregate_JTW_2016_2021$train + Aggregate_JTW_2016_2021$bus + Aggregate_JTW_2016_2021$ferry + Aggregate_JTW_2016_2021$tram

Aggregate_JTW_2016_2021$non_motorised <- Aggregate_JTW_2016_2021$bicycle + Aggregate_JTW_2016_2021$walked_only

#Summarise all, including did not work, not stated and not applicable
kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns()
)




#pivot_longer 
Aggregate_JTW_2016_2021_summary_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")], 
  cols = c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home"), 
  names_to = "Mode or activity",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_summary_longer$`Mode or activity` <- factor( Aggregate_JTW_2016_2021_summary_longer$`Mode or activity`, levels = c("worked_at_home", "other_mode", "non_motorised", "transit", "private_vehicle_passenger", "private_vehicle_drive"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_summary_longer[,], 
  x = `Mode or activity`,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode/activity shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)


```


A Pearson's chi-squared test indicated that the relationship between census and JTW activity/mode was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]))`.


The number of people who drove a private vehicle increased (+`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]))`, or by +`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"])-1)`), but the drive mode share dropped (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`).



The number of people who were a passenger in a private vehicle changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"])-1)`), with passenger mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 


The number of people who used transit changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])/as.numeric(Aggregate_JTW_2016_2021[1,"transit"])-1)`), with transit mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"transit"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"transit"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The following summarizes the mode split amongst those who used transit: 


The number of people who used non-motorised modes shifted by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])-as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])/as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])-1)`), with non-motorised mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`.



The number of people who worked from home changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])-as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])/as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"])-1)`), with WFH share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 


```{r Outer_East_CBD_Transit_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Greater Perth, journey to work mode share by train and bus, 2021 and 2016 censuses"}


#pivot_longer 
Aggregate_JTW_2016_2021_transit_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "train", "bus", "ferry")], 
  cols = c("train", "bus", "ferry"), 
  names_to = "Mode",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_transit_longer$Mode <- factor(Aggregate_JTW_2016_2021_transit_longer$Mode, levels = c("train", "bus", "ferry", "tram"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_transit_longer[,], 
  x = Mode,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares for transit, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram", "private_vehicle_drive", "private_vehicle_passenger", "non_motorised", "other_mode", "worked_at_home" )]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)



```


A Pearson's chi-squared test indicated that the relationship between census and the shares of train, bus and ferry ridership was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("train", "bus", "ferry")]))`.

The number of people who used the train fell by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])-as.numeric(Aggregate_JTW_2016_2021[1,"train"])))`(`r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])/as.numeric(Aggregate_JTW_2016_2021[1,"train"])-1))`). However, train ridership as a share of transit ridership increased by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. Overall, however, the train mode share dropped by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

Bus ridership amongst those with a usual residence within the North-south grouping of LGAs fell by a similar amount (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])-as.numeric(Aggregate_JTW_2016_2021[1,"bus"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])/as.numeric(Aggregate_JTW_2016_2021[1,"bus"])-1)`). Bus ridership rose as a share of transit ridership by `r label_percent(accuracy = 0.1)((as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. However, the bus mode share fell by only `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.



## 3.4 Place of work - Rest of Greater Perth

The following shows results for all people whose usual residence is within Greater Perth and whose place of work is within the rest of Greater Perth (not the City of Perth). 

```{r NOT_CBD_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Place of work in the rest of Greater Perth and usual residence in Greater Perth, journey to work mode share, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in perth
Aggregate_JTW_2016_2021 <- tibble(LGA_UR_LGA_POW_JTW_2016 %>% filter(place_of_work == "Rest of Greater Perth") %>% adorn_totals() %>% tail(n=1))
Aggregate_JTW_2016_2021 <- add_row(Aggregate_JTW_2016_2021, LGA_UR_LGA_POW_JTW_2021 %>% filter(place_of_work == "Rest of Greater Perth") %>% adorn_totals() %>% tail(n=1))

Aggregate_JTW_2016_2021$Year <- c("2016", "2021")

#combine modes to obtain PT, private vehicle (drive), private vehicle (passenger)  and non-motorised columns
Aggregate_JTW_2016_2021$private_vehicle_drive <- Aggregate_JTW_2016_2021$car_as_driver + Aggregate_JTW_2016_2021$truck + Aggregate_JTW_2016_2021$motorbike_scooter  

Aggregate_JTW_2016_2021$private_vehicle_passenger <- Aggregate_JTW_2016_2021$car_as_passenger + Aggregate_JTW_2016_2021$taxi  

Aggregate_JTW_2016_2021$transit <- Aggregate_JTW_2016_2021$train + Aggregate_JTW_2016_2021$bus + Aggregate_JTW_2016_2021$ferry + Aggregate_JTW_2016_2021$tram

Aggregate_JTW_2016_2021$non_motorised <- Aggregate_JTW_2016_2021$bicycle + Aggregate_JTW_2016_2021$walked_only

#Summarise all, including did not work, not stated and not applicable
kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns()
)




#pivot_longer 
Aggregate_JTW_2016_2021_summary_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")], 
  cols = c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home"), 
  names_to = "Mode or activity",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_summary_longer$`Mode or activity` <- factor( Aggregate_JTW_2016_2021_summary_longer$`Mode or activity`, levels = c("worked_at_home", "other_mode", "non_motorised", "transit", "private_vehicle_passenger", "private_vehicle_drive"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_summary_longer[,], 
  x = `Mode or activity`,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode/activity shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)


```


A Pearson's chi-squared test indicated that the relationship between census and JTW activity/mode was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]))`. The number of people who drove a private vehicle changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"])-1)`).   Drive mode share changed by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The number of people who worked from home changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])-as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])/as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"])-1)`). WFH share changed by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The number of people who were a passenger in a private vehicle changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"])-1)`). Passenger mode share changed by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The number of people who used non-motorised modes shifted by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])-as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])/as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])-1)`). Non-motorised mode share changed by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`.


The number of people who used transit shifted by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])/as.numeric(Aggregate_JTW_2016_2021[1,"transit"])-1)`). Transit mode share changed by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"transit"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"transit"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The following summarizes the mode split amongst those who used transit: 


```{r Not_CBD_Transit_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Greater Perth, journey to work mode share by train and bus, 2021 and 2016 censuses"}


#pivot_longer 
Aggregate_JTW_2016_2021_transit_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "train", "bus", "ferry")], 
  cols = c("train", "bus", "ferry"), 
  names_to = "Mode",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_transit_longer$Mode <- factor(Aggregate_JTW_2016_2021_transit_longer$Mode, levels = c("train", "bus", "ferry", "tram"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_transit_longer[,], 
  x = Mode,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares for transit, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram", "private_vehicle_drive", "private_vehicle_passenger", "non_motorised", "other_mode", "worked_at_home" )]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)



```


A Pearson's chi-squared test indicated that the relationship between census and the shares of train, bus and ferry ridership was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("train", "bus", "ferry")]))`.

The number of people who used the train fell by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])-as.numeric(Aggregate_JTW_2016_2021[1,"train"])))`(`r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])/as.numeric(Aggregate_JTW_2016_2021[1,"train"])-1))`). However, train ridership as a share of transit ridership increased by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. Overall, however, the train mode share dropped by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

Bus ridership amongst those with a usual residence within the North-south grouping of LGAs fell by a similar amount (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])-as.numeric(Aggregate_JTW_2016_2021[1,"bus"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])/as.numeric(Aggregate_JTW_2016_2021[1,"bus"])-1)`). Bus ridership rose as a share of transit ridership by `r label_percent(accuracy = 0.1)((as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. However, the bus mode share fell by only `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.




### 3.4.1 Heritage grouping


The following shows results for all people whose usual residence is within the Heritage grouping of LGAs and whose place of work is in Greater Perth but not within the (central) Perth LGA. 

```{r Heritage_not_CBD_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Heritage grouping residents whose place of work is in Greater Perth but not within the (central) Perth LGA, journey to work mode share, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in perth
Aggregate_JTW_2016_2021 <- tibble(LGA_UR_LGA_POW_JTW_2016 %>% filter(place_of_work == "Rest of Greater Perth") %>% filter(grouping == "Heritage") %>% adorn_totals() %>% tail(n=1))
Aggregate_JTW_2016_2021 <- add_row(Aggregate_JTW_2016_2021, LGA_UR_LGA_POW_JTW_2021 %>% filter(place_of_work == "Rest of Greater Perth") %>% filter(grouping == "Heritage") %>% adorn_totals() %>% tail(n=1))

Aggregate_JTW_2016_2021$Year <- c("2016", "2021")

#combine modes to obtain PT, private vehicle (drive), private vehicle (passenger)  and non-motorised columns
Aggregate_JTW_2016_2021$private_vehicle_drive <- Aggregate_JTW_2016_2021$car_as_driver + Aggregate_JTW_2016_2021$truck + Aggregate_JTW_2016_2021$motorbike_scooter  

Aggregate_JTW_2016_2021$private_vehicle_passenger <- Aggregate_JTW_2016_2021$car_as_passenger + Aggregate_JTW_2016_2021$taxi  

Aggregate_JTW_2016_2021$transit <- Aggregate_JTW_2016_2021$train + Aggregate_JTW_2016_2021$bus + Aggregate_JTW_2016_2021$ferry + Aggregate_JTW_2016_2021$tram

Aggregate_JTW_2016_2021$non_motorised <- Aggregate_JTW_2016_2021$bicycle + Aggregate_JTW_2016_2021$walked_only

#Summarise all, including did not work, not stated and not applicable
kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns()
)




#pivot_longer 
Aggregate_JTW_2016_2021_summary_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")], 
  cols = c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home"), 
  names_to = "Mode or activity",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_summary_longer$`Mode or activity` <- factor( Aggregate_JTW_2016_2021_summary_longer$`Mode or activity`, levels = c("worked_at_home", "other_mode", "non_motorised", "transit", "private_vehicle_passenger", "private_vehicle_drive"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_summary_longer[,], 
  x = `Mode or activity`,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode/activity shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)


```


A Pearson's chi-squared test indicated that the relationship between census and JTW activity/mode was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]))`.


The number of people who drove a private vehicle increased (+`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]))`, or by +`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"])-1)`), but the drive mode share dropped (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`).



The number of people who were a passenger in a private vehicle changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"])-1)`), with passenger mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 


The number of people who used transit changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])/as.numeric(Aggregate_JTW_2016_2021[1,"transit"])-1)`), with transit mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"transit"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"transit"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The following summarizes the mode split amongst those who used transit: 


The number of people who used non-motorised modes shifted by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])-as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])/as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])-1)`), with non-motorised mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`.



The number of people who worked from home changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])-as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])/as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"])-1)`), with WFH share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 


```{r Heritage_not_CBD_Transit_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Greater Perth, journey to work mode share by train and bus, 2021 and 2016 censuses"}


#pivot_longer 
Aggregate_JTW_2016_2021_transit_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "train", "bus", "ferry")], 
  cols = c("train", "bus", "ferry"), 
  names_to = "Mode",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_transit_longer$Mode <- factor(Aggregate_JTW_2016_2021_transit_longer$Mode, levels = c("train", "bus", "ferry", "tram"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_transit_longer[,], 
  x = Mode,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares for transit, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram", "private_vehicle_drive", "private_vehicle_passenger", "non_motorised", "other_mode", "worked_at_home" )]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)



```



A Pearson's chi-squared test indicated that the relationship between census and the shares of train, bus and ferry ridership was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("train", "bus", "ferry")]))`.

The number of people who used the train fell by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])-as.numeric(Aggregate_JTW_2016_2021[1,"train"])))`(`r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])/as.numeric(Aggregate_JTW_2016_2021[1,"train"])-1))`). However, train ridership as a share of transit ridership increased by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. Overall, however, the train mode share dropped by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

Bus ridership amongst those with a usual residence within the North-south grouping of LGAs fell by a similar amount (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])-as.numeric(Aggregate_JTW_2016_2021[1,"bus"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])/as.numeric(Aggregate_JTW_2016_2021[1,"bus"])-1)`). Bus ridership rose as a share of transit ridership by `r label_percent(accuracy = 0.1)((as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. However, the bus mode share fell by only `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.



### 3.4.2 North-south grouping

The following shows results for all people whose usual residence is within the North-south grouping of LGAs and whose place of work is in Greater Perth but not within the (central) Perth LGA. 

```{r North_south_not_CBD_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Residence in North-south grouping whose place of work is in Greater Perth but not within the (central) Perth LGA, journey to work mode share, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in perth
Aggregate_JTW_2016_2021 <- tibble(LGA_UR_LGA_POW_JTW_2016 %>% filter(place_of_work == "Rest of Greater Perth") %>% filter(grouping == "North-south") %>% adorn_totals() %>% tail(n=1))
Aggregate_JTW_2016_2021 <- add_row(Aggregate_JTW_2016_2021, LGA_UR_LGA_POW_JTW_2021 %>% filter(place_of_work == "Rest of Greater Perth") %>% filter(grouping == "North-south") %>% adorn_totals() %>% tail(n=1))

Aggregate_JTW_2016_2021$Year <- c("2016", "2021")

#combine modes to obtain PT, private vehicle (drive), private vehicle (passenger)  and non-motorised columns
Aggregate_JTW_2016_2021$private_vehicle_drive <- Aggregate_JTW_2016_2021$car_as_driver + Aggregate_JTW_2016_2021$truck + Aggregate_JTW_2016_2021$motorbike_scooter  

Aggregate_JTW_2016_2021$private_vehicle_passenger <- Aggregate_JTW_2016_2021$car_as_passenger + Aggregate_JTW_2016_2021$taxi  

Aggregate_JTW_2016_2021$transit <- Aggregate_JTW_2016_2021$train + Aggregate_JTW_2016_2021$bus + Aggregate_JTW_2016_2021$ferry + Aggregate_JTW_2016_2021$tram

Aggregate_JTW_2016_2021$non_motorised <- Aggregate_JTW_2016_2021$bicycle + Aggregate_JTW_2016_2021$walked_only

#Summarise all, including did not work, not stated and not applicable
kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns()
)




#pivot_longer 
Aggregate_JTW_2016_2021_summary_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")], 
  cols = c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home"), 
  names_to = "Mode or activity",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_summary_longer$`Mode or activity` <- factor( Aggregate_JTW_2016_2021_summary_longer$`Mode or activity`, levels = c("worked_at_home", "other_mode", "non_motorised", "transit", "private_vehicle_passenger", "private_vehicle_drive"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_summary_longer[,], 
  x = `Mode or activity`,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode/activity shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)


```


A Pearson's chi-squared test indicated that the relationship between census and JTW activity/mode was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]))`.


The number of people who drove a private vehicle increased (+`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]))`, or by +`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"])-1)`), but the drive mode share dropped (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`).



The number of people who were a passenger in a private vehicle changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"])-1)`), with passenger mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 


The number of people who used transit changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])/as.numeric(Aggregate_JTW_2016_2021[1,"transit"])-1)`), with transit mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"transit"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"transit"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The following summarizes the mode split amongst those who used transit: 


The number of people who used non-motorised modes shifted by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])-as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])/as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])-1)`), with non-motorised mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`.



The number of people who worked from home changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])-as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])/as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"])-1)`), with WFH share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 


```{r NOrth_south_not_CBD_Transit_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Greater Perth, journey to work mode share by train and bus, 2021 and 2016 censuses"}


#pivot_longer 
Aggregate_JTW_2016_2021_transit_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "train", "bus", "ferry")], 
  cols = c("train", "bus", "ferry"), 
  names_to = "Mode",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_transit_longer$Mode <- factor(Aggregate_JTW_2016_2021_transit_longer$Mode, levels = c("train", "bus", "ferry", "tram"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_transit_longer[,], 
  x = Mode,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares for transit, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram", "private_vehicle_drive", "private_vehicle_passenger", "non_motorised", "other_mode", "worked_at_home" )]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)



```


A Pearson's chi-squared test indicated that the relationship between census and the shares of train, bus and ferry ridership was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("train", "bus", "ferry")]))`.

The number of people who used the train fell by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])-as.numeric(Aggregate_JTW_2016_2021[1,"train"])))`(`r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])/as.numeric(Aggregate_JTW_2016_2021[1,"train"])-1))`). However, train ridership as a share of transit ridership increased by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. Overall, however, the train mode share dropped by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

Bus ridership amongst those with a usual residence within the North-south grouping of LGAs fell by a similar amount (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])-as.numeric(Aggregate_JTW_2016_2021[1,"bus"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])/as.numeric(Aggregate_JTW_2016_2021[1,"bus"])-1)`). Bus ridership rose as a share of transit ridership by `r label_percent(accuracy = 0.1)((as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. However, the bus mode share fell by only `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.




### 3.4.3 Outer-east grouping

The following shows results for all people whose usual residence is within the Outer-east grouping of LGAs and whose place of work is in Greater Perth but not within the (central) Perth LGA.

```{r Outer_east_not_CBD_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="North-south grouping, whose place of work is in Greater Perth but not within the (central) Perth LGA, journey to work mode share, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in perth
Aggregate_JTW_2016_2021 <- tibble(LGA_UR_LGA_POW_JTW_2016 %>% filter(place_of_work == "Rest of Greater Perth") %>% filter(grouping == "Outer-east") %>% adorn_totals() %>% tail(n=1))
Aggregate_JTW_2016_2021 <- add_row(Aggregate_JTW_2016_2021, LGA_UR_LGA_POW_JTW_2021 %>% filter(place_of_work == "CBD") %>% filter(grouping == "Outer-east") %>% adorn_totals() %>% tail(n=1))

Aggregate_JTW_2016_2021$Year <- c("2016", "2021")

#combine modes to obtain PT, private vehicle (drive), private vehicle (passenger)  and non-motorised columns
Aggregate_JTW_2016_2021$private_vehicle_drive <- Aggregate_JTW_2016_2021$car_as_driver + Aggregate_JTW_2016_2021$truck + Aggregate_JTW_2016_2021$motorbike_scooter  

Aggregate_JTW_2016_2021$private_vehicle_passenger <- Aggregate_JTW_2016_2021$car_as_passenger + Aggregate_JTW_2016_2021$taxi  

Aggregate_JTW_2016_2021$transit <- Aggregate_JTW_2016_2021$train + Aggregate_JTW_2016_2021$bus + Aggregate_JTW_2016_2021$ferry + Aggregate_JTW_2016_2021$tram

Aggregate_JTW_2016_2021$non_motorised <- Aggregate_JTW_2016_2021$bicycle + Aggregate_JTW_2016_2021$walked_only

#Summarise all, including did not work, not stated and not applicable
kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns()
)




#pivot_longer 
Aggregate_JTW_2016_2021_summary_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")], 
  cols = c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home"), 
  names_to = "Mode or activity",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_summary_longer$`Mode or activity` <- factor( Aggregate_JTW_2016_2021_summary_longer$`Mode or activity`, levels = c("worked_at_home", "other_mode", "non_motorised", "transit", "private_vehicle_passenger", "private_vehicle_drive"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_summary_longer[,], 
  x = `Mode or activity`,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode/activity shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)


```


A Pearson's chi-squared test indicated that the relationship between census and JTW activity/mode was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]))`.


The number of people who drove a private vehicle increased (+`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]))`, or by +`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"])-1)`), but the drive mode share dropped (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`).



The number of people who were a passenger in a private vehicle changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"])-1)`), with passenger mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 


The number of people who used transit changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])/as.numeric(Aggregate_JTW_2016_2021[1,"transit"])-1)`), with transit mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"transit"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"transit"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The following summarizes the mode split amongst those who used transit: 


The number of people who used non-motorised modes shifted by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])-as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])/as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])-1)`), with non-motorised mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`.



The number of people who worked from home changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])-as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])/as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"])-1)`), with WFH share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 



```{r Outer_east_not_CBD_Transit_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Greater Perth, journey to work mode share by train and bus, 2021 and 2016 censuses"}


#pivot_longer 
Aggregate_JTW_2016_2021_transit_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "train", "bus", "ferry")], 
  cols = c("train", "bus", "ferry"), 
  names_to = "Mode",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_transit_longer$Mode <- factor(Aggregate_JTW_2016_2021_transit_longer$Mode, levels = c("train", "bus", "ferry", "tram"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_transit_longer[,], 
  x = Mode,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares for transit, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram", "private_vehicle_drive", "private_vehicle_passenger", "non_motorised", "other_mode", "worked_at_home" )]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)



```


A Pearson's chi-squared test indicated that the relationship between census and the shares of train, bus and ferry ridership was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("train", "bus", "ferry")]))`.

The number of people who used the train fell by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])-as.numeric(Aggregate_JTW_2016_2021[1,"train"])))`(`r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])/as.numeric(Aggregate_JTW_2016_2021[1,"train"])-1))`). However, train ridership as a share of transit ridership increased by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. Overall, however, the train mode share dropped by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

Bus ridership amongst those with a usual residence within the North-south grouping of LGAs fell by a similar amount (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])-as.numeric(Aggregate_JTW_2016_2021[1,"bus"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])/as.numeric(Aggregate_JTW_2016_2021[1,"bus"])-1)`). Bus ridership rose as a share of transit ridership by `r label_percent(accuracy = 0.1)((as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. However, the bus mode share fell by only `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.



## 3.5 Place of work - not Greater Perth
The following shows results for all people whose usual residence is within Greater Perth and whose place of work is in Greater Perth but not within the (central) Perth LGA. 

```{r not_Perth_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Place of work not in Greater Perth and usual residence in Greater Perth, journey to work mode share, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in perth
Aggregate_JTW_2016_2021 <- tibble(LGA_UR_LGA_POW_JTW_2016 %>% filter(place_of_work == "Other") %>% adorn_totals() %>% tail(n=1))
Aggregate_JTW_2016_2021 <- add_row(Aggregate_JTW_2016_2021, LGA_UR_LGA_POW_JTW_2021 %>% filter(place_of_work == "Other") %>% adorn_totals() %>% tail(n=1))

Aggregate_JTW_2016_2021$Year <- c("2016", "2021")

#combine modes to obtain PT, private vehicle (drive), private vehicle (passenger)  and non-motorised columns
Aggregate_JTW_2016_2021$private_vehicle_drive <- Aggregate_JTW_2016_2021$car_as_driver + Aggregate_JTW_2016_2021$truck + Aggregate_JTW_2016_2021$motorbike_scooter  

Aggregate_JTW_2016_2021$private_vehicle_passenger <- Aggregate_JTW_2016_2021$car_as_passenger + Aggregate_JTW_2016_2021$taxi  

Aggregate_JTW_2016_2021$transit <- Aggregate_JTW_2016_2021$train + Aggregate_JTW_2016_2021$bus + Aggregate_JTW_2016_2021$ferry + Aggregate_JTW_2016_2021$tram

Aggregate_JTW_2016_2021$non_motorised <- Aggregate_JTW_2016_2021$bicycle + Aggregate_JTW_2016_2021$walked_only

#Summarise all, including did not work, not stated and not applicable
kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns()
)




#pivot_longer 
Aggregate_JTW_2016_2021_summary_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")], 
  cols = c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home"), 
  names_to = "Mode or activity",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_summary_longer$`Mode or activity` <- factor( Aggregate_JTW_2016_2021_summary_longer$`Mode or activity`, levels = c("worked_at_home", "other_mode", "non_motorised", "transit", "private_vehicle_passenger", "private_vehicle_drive"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_summary_longer[,], 
  x = `Mode or activity`,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode/activity shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)


```


A Pearson's chi-squared test indicated that the relationship between census and JTW activity/mode was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]))`. The number of people who drove a private vehicle changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"])-1)`).   Drive mode share changed by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The number of people who worked from home changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])-as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])/as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"])-1)`). WFH share changed by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The number of people who were a passenger in a private vehicle changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"])-1)`). Passenger mode share changed by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The number of people who used non-motorised modes shifted by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])-as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])/as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])-1)`). Non-motorised mode share changed by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`.


The number of people who used transit shifted by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])/as.numeric(Aggregate_JTW_2016_2021[1,"transit"])-1)`). Transit mode share changed by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"transit"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"transit"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The following summarizes the mode split amongst those who used transit: 


```{r Not_Perth_Transit_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Greater Perth, journey to work mode share by train and bus, 2021 and 2016 censuses"}


#pivot_longer 
Aggregate_JTW_2016_2021_transit_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "train", "bus", "ferry")], 
  cols = c("train", "bus", "ferry"), 
  names_to = "Mode",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_transit_longer$Mode <- factor(Aggregate_JTW_2016_2021_transit_longer$Mode, levels = c("train", "bus", "ferry", "tram"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_transit_longer[,], 
  x = Mode,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares for transit, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram", "private_vehicle_drive", "private_vehicle_passenger", "non_motorised", "other_mode", "worked_at_home" )]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)



```


A Pearson's chi-squared test indicated that the relationship between census and the shares of train, bus and ferry ridership was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("train", "bus", "ferry")]))`.

The number of people who used the train fell by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])-as.numeric(Aggregate_JTW_2016_2021[1,"train"])))`(`r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])/as.numeric(Aggregate_JTW_2016_2021[1,"train"])-1))`). However, train ridership as a share of transit ridership increased by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. Overall, however, the train mode share dropped by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

Bus ridership amongst those with a usual residence within the North-south grouping of LGAs fell by a similar amount (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])-as.numeric(Aggregate_JTW_2016_2021[1,"bus"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])/as.numeric(Aggregate_JTW_2016_2021[1,"bus"])-1)`). Bus ridership rose as a share of transit ridership by `r label_percent(accuracy = 0.1)((as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. However, the bus mode share fell by only `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.



### 3.5.1 Heritage grouping


The following shows results for all people whose usual residence is within the Heritage grouping of LGAs and whose place of work is in Greater Perth but not within the (central) Perth LGA. 

```{r Heritage_not_Perth_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Heritage grouping residents whose Place of work not in Greater Perth , journey to work mode share, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in perth
Aggregate_JTW_2016_2021 <- tibble(LGA_UR_LGA_POW_JTW_2016 %>% filter(place_of_work == "Other") %>% filter(grouping == "Heritage") %>% adorn_totals() %>% tail(n=1))
Aggregate_JTW_2016_2021 <- add_row(Aggregate_JTW_2016_2021, LGA_UR_LGA_POW_JTW_2021 %>% filter(place_of_work == "Other") %>% filter(grouping == "Heritage") %>% adorn_totals() %>% tail(n=1))

Aggregate_JTW_2016_2021$Year <- c("2016", "2021")

#combine modes to obtain PT, private vehicle (drive), private vehicle (passenger)  and non-motorised columns
Aggregate_JTW_2016_2021$private_vehicle_drive <- Aggregate_JTW_2016_2021$car_as_driver + Aggregate_JTW_2016_2021$truck + Aggregate_JTW_2016_2021$motorbike_scooter  

Aggregate_JTW_2016_2021$private_vehicle_passenger <- Aggregate_JTW_2016_2021$car_as_passenger + Aggregate_JTW_2016_2021$taxi  

Aggregate_JTW_2016_2021$transit <- Aggregate_JTW_2016_2021$train + Aggregate_JTW_2016_2021$bus + Aggregate_JTW_2016_2021$ferry + Aggregate_JTW_2016_2021$tram

Aggregate_JTW_2016_2021$non_motorised <- Aggregate_JTW_2016_2021$bicycle + Aggregate_JTW_2016_2021$walked_only

#Summarise all, including did not work, not stated and not applicable
kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns()
)




#pivot_longer 
Aggregate_JTW_2016_2021_summary_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")], 
  cols = c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home"), 
  names_to = "Mode or activity",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_summary_longer$`Mode or activity` <- factor( Aggregate_JTW_2016_2021_summary_longer$`Mode or activity`, levels = c("worked_at_home", "other_mode", "non_motorised", "transit", "private_vehicle_passenger", "private_vehicle_drive"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_summary_longer[,], 
  x = `Mode or activity`,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode/activity shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)


```

A Pearson's chi-squared test indicated that the relationship between census and JTW activity/mode was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]))`.


The number of people who drove a private vehicle increased (+`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]))`, or by +`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"])-1)`), but the drive mode share dropped (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`).



The number of people who were a passenger in a private vehicle changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"])-1)`), with passenger mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 


The number of people who used transit changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])/as.numeric(Aggregate_JTW_2016_2021[1,"transit"])-1)`), with transit mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"transit"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"transit"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The following summarizes the mode split amongst those who used transit: 


The number of people who used non-motorised modes shifted by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])-as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])/as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])-1)`), with non-motorised mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`.



The number of people who worked from home changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])-as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])/as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"])-1)`), with WFH share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 



```{r Heritage_not_Perth_Transit_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Greater Perth, journey to work mode share by train and bus, 2021 and 2016 censuses"}


#pivot_longer 
Aggregate_JTW_2016_2021_transit_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "train", "bus", "ferry")], 
  cols = c("train", "bus", "ferry"), 
  names_to = "Mode",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_transit_longer$Mode <- factor(Aggregate_JTW_2016_2021_transit_longer$Mode, levels = c("train", "bus", "ferry", "tram"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_transit_longer[,], 
  x = Mode,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares for transit, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram", "private_vehicle_drive", "private_vehicle_passenger", "non_motorised", "other_mode", "worked_at_home" )]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)



```


A Pearson's chi-squared test indicated that the relationship between census and the shares of train, bus and ferry ridership was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("train", "bus", "ferry")]))`.

The number of people who used the train fell by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])-as.numeric(Aggregate_JTW_2016_2021[1,"train"])))`(`r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])/as.numeric(Aggregate_JTW_2016_2021[1,"train"])-1))`). However, train ridership as a share of transit ridership increased by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. Overall, however, the train mode share dropped by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

Bus ridership amongst those with a usual residence within the North-south grouping of LGAs fell by a similar amount (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])-as.numeric(Aggregate_JTW_2016_2021[1,"bus"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])/as.numeric(Aggregate_JTW_2016_2021[1,"bus"])-1)`). Bus ridership rose as a share of transit ridership by `r label_percent(accuracy = 0.1)((as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. However, the bus mode share fell by only `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.



### 3.5.2 North-south grouping

The following shows results for all people whose usual residence is within the North-south grouping of LGAs and whose place of work is not in Greater Perth. 

```{r North_south_not_Perth_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Residence in North-south grouping whose Place of work not in Greater Perth, journey to work mode share, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in perth
Aggregate_JTW_2016_2021 <- tibble(LGA_UR_LGA_POW_JTW_2016 %>% filter(place_of_work == "Other") %>% filter(grouping == "North-south") %>% adorn_totals() %>% tail(n=1))
Aggregate_JTW_2016_2021 <- add_row(Aggregate_JTW_2016_2021, LGA_UR_LGA_POW_JTW_2021 %>% filter(place_of_work == "Other") %>% filter(grouping == "North-south") %>% adorn_totals() %>% tail(n=1))

Aggregate_JTW_2016_2021$Year <- c("2016", "2021")

#combine modes to obtain PT, private vehicle (drive), private vehicle (passenger)  and non-motorised columns
Aggregate_JTW_2016_2021$private_vehicle_drive <- Aggregate_JTW_2016_2021$car_as_driver + Aggregate_JTW_2016_2021$truck + Aggregate_JTW_2016_2021$motorbike_scooter  

Aggregate_JTW_2016_2021$private_vehicle_passenger <- Aggregate_JTW_2016_2021$car_as_passenger + Aggregate_JTW_2016_2021$taxi  

Aggregate_JTW_2016_2021$transit <- Aggregate_JTW_2016_2021$train + Aggregate_JTW_2016_2021$bus + Aggregate_JTW_2016_2021$ferry + Aggregate_JTW_2016_2021$tram

Aggregate_JTW_2016_2021$non_motorised <- Aggregate_JTW_2016_2021$bicycle + Aggregate_JTW_2016_2021$walked_only

#Summarise all, including did not work, not stated and not applicable
kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns()
)




#pivot_longer 
Aggregate_JTW_2016_2021_summary_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")], 
  cols = c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home"), 
  names_to = "Mode or activity",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_summary_longer$`Mode or activity` <- factor( Aggregate_JTW_2016_2021_summary_longer$`Mode or activity`, levels = c("worked_at_home", "other_mode", "non_motorised", "transit", "private_vehicle_passenger", "private_vehicle_drive"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_summary_longer[,], 
  x = `Mode or activity`,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode/activity shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)


```


A Pearson's chi-squared test indicated that the relationship between census and JTW activity/mode was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]))`.


The number of people who drove a private vehicle increased (+`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]))`, or by +`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"])-1)`), but the drive mode share dropped (`r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`).



The number of people who were a passenger in a private vehicle changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"])-1)`), with passenger mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 


The number of people who used transit changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])/as.numeric(Aggregate_JTW_2016_2021[1,"transit"])-1)`), with transit mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"transit"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"transit"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The following summarizes the mode split amongst those who used transit: 


The number of people who used non-motorised modes shifted by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])-as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])/as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])-1)`), with non-motorised mode share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`.



The number of people who worked from home changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])-as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])/as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"])-1)`), with WFH share changing by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. 



```{r North_south_not_Perth_Transit_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Greater Perth, journey to work mode share by train and bus, 2021 and 2016 censuses"}


#pivot_longer 
Aggregate_JTW_2016_2021_transit_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "train", "bus", "ferry")], 
  cols = c("train", "bus", "ferry"), 
  names_to = "Mode",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_transit_longer$Mode <- factor(Aggregate_JTW_2016_2021_transit_longer$Mode, levels = c("train", "bus", "ferry", "tram"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_transit_longer[,], 
  x = Mode,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares for transit, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram", "private_vehicle_drive", "private_vehicle_passenger", "non_motorised", "other_mode", "worked_at_home" )]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)



```



A Pearson's chi-squared test indicated that the relationship between census and the shares of train, bus and ferry ridership was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("train", "bus", "ferry")]))`.

The number of people who used the train fell by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])-as.numeric(Aggregate_JTW_2016_2021[1,"train"])))`(`r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])/as.numeric(Aggregate_JTW_2016_2021[1,"train"])-1))`). However, train ridership as a share of transit ridership increased by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. Overall, however, the train mode share dropped by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

Bus ridership amongst those with a usual residence within the North-south grouping of LGAs fell by a similar amount (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])-as.numeric(Aggregate_JTW_2016_2021[1,"bus"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])/as.numeric(Aggregate_JTW_2016_2021[1,"bus"])-1)`). Bus ridership rose as a share of transit ridership by `r label_percent(accuracy = 0.1)((as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. However, the bus mode share fell by only `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.



### 3.5.3 Outer-east grouping

The following shows results for all people whose usual residence is within the Outer-east grouping of LGAs and whose place of work is not in Greater Perth.

```{r Outer_east_not_Perth_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Outer-east grouping, whose place of work is is not in Greater Perth, journey to work mode share, 2021 and 2016 censuses"}

#calculate aggregates for everyone with a usual residence in perth
Aggregate_JTW_2016_2021 <- tibble(LGA_UR_LGA_POW_JTW_2016 %>% filter(place_of_work == "Rest of Greater Perth") %>% filter(grouping == "Outer-east") %>% adorn_totals() %>% tail(n=1))
Aggregate_JTW_2016_2021 <- add_row(Aggregate_JTW_2016_2021, LGA_UR_LGA_POW_JTW_2021 %>% filter(place_of_work == "CBD") %>% filter(grouping == "Outer-east") %>% adorn_totals() %>% tail(n=1))

Aggregate_JTW_2016_2021$Year <- c("2016", "2021")

#combine modes to obtain PT, private vehicle (drive), private vehicle (passenger)  and non-motorised columns
Aggregate_JTW_2016_2021$private_vehicle_drive <- Aggregate_JTW_2016_2021$car_as_driver + Aggregate_JTW_2016_2021$truck + Aggregate_JTW_2016_2021$motorbike_scooter  

Aggregate_JTW_2016_2021$private_vehicle_passenger <- Aggregate_JTW_2016_2021$car_as_passenger + Aggregate_JTW_2016_2021$taxi  

Aggregate_JTW_2016_2021$transit <- Aggregate_JTW_2016_2021$train + Aggregate_JTW_2016_2021$bus + Aggregate_JTW_2016_2021$ferry + Aggregate_JTW_2016_2021$tram

Aggregate_JTW_2016_2021$non_motorised <- Aggregate_JTW_2016_2021$bicycle + Aggregate_JTW_2016_2021$walked_only

#Summarise all, including did not work, not stated and not applicable
kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home", "did_not_go_to_work", "not_stated", "not_applicable")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns()
)




#pivot_longer 
Aggregate_JTW_2016_2021_summary_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")], 
  cols = c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home"), 
  names_to = "Mode or activity",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_summary_longer$`Mode or activity` <- factor( Aggregate_JTW_2016_2021_summary_longer$`Mode or activity`, levels = c("worked_at_home", "other_mode", "non_motorised", "transit", "private_vehicle_passenger", "private_vehicle_drive"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_summary_longer[,], 
  x = `Mode or activity`,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode/activity shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)


```


A Pearson's chi-squared test indicated that the relationship between census and JTW activity/mode was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("private_vehicle_drive", "private_vehicle_passenger", "transit", "non_motorised", "other_mode", "worked_at_home")]))`. The number of people who drove a private vehicle changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"])-1)`).   Drive mode share changed by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The number of people who worked from home changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])-as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"])/as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"])-1)`). WFH share changed by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"worked_at_home"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"worked_at_home"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The number of people who were a passenger in a private vehicle changed by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])-as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"])/as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"])-1)`). Passenger mode share changed by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The number of people who used non-motorised modes shifted by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])-as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"])/as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"])-1)`). Non-motorised mode share changed by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"non_motorised"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"non_motorised"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`.


The number of people who used transit shifted by `r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])-as.numeric(Aggregate_JTW_2016_2021[1,"transit"]))`(`r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"transit"])/as.numeric(Aggregate_JTW_2016_2021[1,"transit"])-1)`). Transit mode share changed by `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"transit"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"transit"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"])))`. The following summarizes the mode split amongst those who used transit: 


```{r Outer_east_not_Perth_Transit_JTW, echo=FALSE, message=FALSE, warning=FALSE, fig.margin=FALSE, fig.fullwidth=FALSE, fig.cap="Greater Perth, journey to work mode share by train and bus, 2021 and 2016 censuses"}


#pivot_longer 
Aggregate_JTW_2016_2021_transit_longer <- pivot_longer(
  Aggregate_JTW_2016_2021[, c("Year", "train", "bus", "ferry")], 
  cols = c("train", "bus", "ferry"), 
  names_to = "Mode",
  values_to = "People"
)


#turn mode into a factor to get a specific order
Aggregate_JTW_2016_2021_transit_longer$Mode <- factor(Aggregate_JTW_2016_2021_transit_longer$Mode, levels = c("train", "bus", "ferry", "tram"))

p <- ggbarstats(
  Aggregate_JTW_2016_2021_transit_longer[,], 
  x = Mode,
  y = Year,
  counts = People
)

p

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram")]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares for transit, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)

kable(untabyl(Aggregate_JTW_2016_2021[,c("Year", "train", "bus", "ferry", "tram", "private_vehicle_drive", "private_vehicle_passenger", "non_motorised", "other_mode", "worked_at_home" )]) %>% adorn_totals(where = "col") %>% adorn_percentages() %>% adorn_pct_formatting() %>% adorn_ns(), caption = "Journey to work mode shares, persons with a usual residence in Greater Perth, 2016 and 2021 censuses; excluding did not go to work, not stated and not applicable"
)



```

A Pearson's chi-squared test indicated that the relationship between census and the shares of train, bus and ferry ridership was significant `r print_chi2(as.matrix(Aggregate_JTW_2016_2021[1:2,c("train", "bus", "ferry")]))`.

The number of people who used the train fell by `r label_number(big.mark = ",")(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])-as.numeric(Aggregate_JTW_2016_2021[1,"train"])))`(`r label_percent()(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"])/as.numeric(Aggregate_JTW_2016_2021[1,"train"])-1))`). However, train ridership as a share of transit ridership increased by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. Overall, however, the train mode share dropped by `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"train"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"train"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.

Bus ridership amongst those with a usual residence within the North-south grouping of LGAs fell by a similar amount (`r label_number(big.mark = ",")(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])-as.numeric(Aggregate_JTW_2016_2021[1,"bus"]))`, `r label_percent()(as.numeric(Aggregate_JTW_2016_2021[2,"bus"])/as.numeric(Aggregate_JTW_2016_2021[1,"bus"])-1)`). Bus ridership rose as a share of transit ridership by `r label_percent(accuracy = 0.1)((as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/( Aggregate_JTW_2016_2021[2,"transit"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"transit"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"transit"])))`. However, the bus mode share fell by only `r label_percent(accuracy = 0.1)(-(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])) - as.numeric(Aggregate_JTW_2016_2021[1,"bus"]/(Aggregate_JTW_2016_2021[1,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[1,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[1,"transit"] + Aggregate_JTW_2016_2021[1,"non_motorised"] + Aggregate_JTW_2016_2021[1,"other_mode"] + Aggregate_JTW_2016_2021[1,"worked_at_home"]))))` to `r label_percent(accuracy = 0.1)(as.numeric(Aggregate_JTW_2016_2021[2,"bus"]/(Aggregate_JTW_2016_2021[2,"private_vehicle_drive"] + Aggregate_JTW_2016_2021[2,"private_vehicle_passenger"] + Aggregate_JTW_2016_2021[2,"transit"] + Aggregate_JTW_2016_2021[2,"non_motorised"] + Aggregate_JTW_2016_2021[2,"other_mode"] + Aggregate_JTW_2016_2021[2,"worked_at_home"])))`.


# 4.0 Discussion

# 5.0 Conclusions

#References




```{r bib, include=FALSE}
# create a bib file for the R packages used in this document
knitr::write_bib(c('base', 'rmarkdown'), file = 'skeleton.bib')
```

